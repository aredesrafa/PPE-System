var l=Object.defineProperty;var u=(s,e,t)=>e in s?l(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var d=(s,e,t)=>u(s,typeof e!="symbol"?e+"":e,t);import{a as r}from"./Dwq3Do7L.js";class p{constructor(){d(this,"baseEndpoint","/estoque/itens");d(this,"itensDisponiveis",{})}async listarItensEstoque(e){console.log("üì¶ EstoqueItensAdapter: Listando itens de estoque",e);try{const t=new URLSearchParams;e!=null&&e.page&&t.append("page",e.page.toString()),e!=null&&e.limit&&t.append("limit",e.limit.toString()),e!=null&&e.search&&t.append("search",e.search),e!=null&&e.almoxarifado_id&&t.append("almoxarifado_id",e.almoxarifado_id),e!=null&&e.tipo_epi_id&&t.append("tipo_epi_id",e.tipo_epi_id),e!=null&&e.status&&e.status!=="todos"&&t.append("status",e.status),e!=null&&e.categoria&&t.append("categoria",e.categoria);const a=`${this.baseEndpoint}?${t.toString()}`,o=await r.get(a);return console.log("‚úÖ Itens de estoque listados:",o.data.pagination),{data:o.data.items,total:o.data.pagination.total,page:o.data.pagination.page,pageSize:o.data.pagination.limit,totalPages:o.data.pagination.totalPages}}catch(t){throw console.error("‚ùå Erro ao listar itens de estoque:",t),new Error("N√£o foi poss√≠vel carregar os itens de estoque")}}async obterItensDisponiveisParaSaida(e){console.log("üöö EstoqueItensAdapter: Buscando itens dispon√≠veis para sa√≠da",e);try{const a=(await this.listarItensEstoque({almoxarifado_id:e,status:"DISPONIVEL",limit:100})).data.filter(o=>o.quantidade>0).map(o=>({value:o.id,label:`${o.tipo_epi.nome_equipamento} - ${o.quantidade} dispon√≠vel`,quantidade:o.quantidade,equipamento:o.tipo_epi.nome_equipamento,categoria:o.tipo_epi.categoria,numeroCA:o.tipo_epi.numero_ca,almoxarifado:o.almoxarifado.nome,almoxarifadoId:o.almoxarifado.id,quantidadeMaxima:o.quantidade,status:o.status,dataValidade:o.data_validade,lote:o.lote,quantidadeDisponivel:o.quantidade}));return a.sort((o,n)=>o.equipamento.localeCompare(n.equipamento)),console.log("‚úÖ Itens dispon√≠veis para sa√≠da:",a.length),a}catch(t){return console.error("‚ùå Erro ao buscar itens dispon√≠veis para sa√≠da:",t),[]}}async buscarItensEstoque(e,t){if(console.log("üîç EstoqueItensAdapter: Buscando itens de estoque",e,t),!e||e.length<2)return[];try{const a={search:e,limit:20,status:"DISPONIVEL",almoxarifado_id:t},n=(await this.listarItensEstoque(a)).data.map(i=>({value:i.id,label:`${i.tipo_epi.nome_equipamento} (${i.quantidade} dispon√≠vel)`,quantidade:i.quantidade,equipamento:i.tipo_epi.nome_equipamento,categoria:i.tipo_epi.categoria,numeroCA:i.tipo_epi.numero_ca,almoxarifado:i.almoxarifado.nome,almoxarifadoId:i.almoxarifado.id,quantidadeMaxima:i.quantidade,status:i.status,dataValidade:i.data_validade,lote:i.lote,quantidadeDisponivel:i.quantidade}));return console.log("‚úÖ Busca realizada, encontrados:",n.length),n}catch(a){return console.error("‚ùå Erro na busca de itens de estoque:",a),[]}}async obterItemEstoque(e){console.log("üîç EstoqueItensAdapter: Buscando item de estoque",e);try{const t=await r.get(`${this.baseEndpoint}/${e}`);return console.log("‚úÖ Item de estoque encontrado:",t.data.tipo_epi.nome_equipamento),t.data}catch(t){throw console.error("‚ùå Erro ao buscar item de estoque:",t),new Error("N√£o foi poss√≠vel encontrar o item de estoque")}}async validarQuantidadeDisponivel(e,t){console.log("‚úÖ EstoqueItensAdapter: Validando quantidade dispon√≠vel",e,t);try{const a=await this.obterItemEstoque(e);return a.status!=="DISPONIVEL"?{valido:!1,quantidadeDisponivel:a.quantidade,motivo:`Item n√£o est√° dispon√≠vel (status: ${a.status})`}:t>a.quantidade?{valido:!1,quantidadeDisponivel:a.quantidade,motivo:`Quantidade desejada (${t}) √© maior que a dispon√≠vel (${a.quantidade})`}:t<=0?{valido:!1,quantidadeDisponivel:a.quantidade,motivo:"Quantidade deve ser maior que zero"}:{valido:!0,quantidadeDisponivel:a.quantidade}}catch(a){return console.error("‚ùå Erro ao validar quantidade dispon√≠vel:",a),{valido:!1,quantidadeDisponivel:0,motivo:"Erro ao validar item de estoque"}}}async obterItensAgrupadosPorTipo(e){console.log("üìä EstoqueItensAdapter: Agrupando itens por tipo de EPI",e);try{const t=await this.listarItensEstoque({almoxarifado_id:e,status:"DISPONIVEL",limit:500}),a={};return t.data.forEach(o=>{const n=o.tipo_epi.id;a[n]||(a[n]={tipo_epi:o.tipo_epi,itens:[],quantidade_total:0}),a[n].itens.push(o),a[n].quantidade_total+=o.quantidade}),console.log("‚úÖ Itens agrupados por tipo:",Object.keys(a).length),a}catch(t){return console.error("‚ùå Erro ao agrupar itens por tipo:",t),{}}}async obterItensDisponiveisComCache(e){const a=Date.now(),o=this.itensDisponiveis[e];if(o&&a-o.timestamp<12e4)return console.log("üíæ EstoqueItensAdapter: Usando cache para itens dispon√≠veis"),o.data;const n=await this.obterItensDisponiveisParaSaida(e);return this.itensDisponiveis[e]={data:n,timestamp:a},n}limparCache(e){e?(delete this.itensDisponiveis[e],console.log("üóëÔ∏è EstoqueItensAdapter: Cache limpo para almoxarifado",e)):(this.itensDisponiveis={},console.log("üóëÔ∏è EstoqueItensAdapter: Cache completo limpo"))}clearCache(){this.limparCache()}async obterItensBaixoEstoque(e){console.log("‚ö†Ô∏è EstoqueItensAdapter: Buscando itens com baixo estoque");try{const a=(await this.listarItensEstoque({almoxarifado_id:e,status:"BAIXO",limit:100})).data.map(o=>({value:o.id,label:`${o.tipo_epi.nome_equipamento} - ${o.quantidade} restante`,quantidade:o.quantidade,equipamento:o.tipo_epi.nome_equipamento,categoria:o.tipo_epi.categoria,numeroCA:o.tipo_epi.numero_ca,almoxarifado:o.almoxarifado.nome,almoxarifadoId:o.almoxarifado.id,quantidadeMaxima:o.quantidade,status:o.status,dataValidade:o.data_validade,lote:o.lote,quantidadeDisponivel:o.quantidade}));return console.log("‚úÖ Itens com baixo estoque:",a.length),a}catch(t){return console.error("‚ùå Erro ao buscar itens com baixo estoque:",t),[]}}async verificarDisponibilidadeRealTime(e){console.log("üîÑ EstoqueItensAdapter: Verificando disponibilidade em tempo real");const t=await Promise.all(e.map(async a=>{try{const o=await this.validarQuantidadeDisponivel(a.itemId,a.quantidade);return{itemId:a.itemId,disponivel:o.valido,quantidadeAtual:o.quantidadeDisponivel,motivo:o.motivo}}catch{return{itemId:a.itemId,disponivel:!1,quantidadeAtual:0,motivo:"Erro ao verificar item"}}}));return console.log("‚úÖ Verifica√ß√£o conclu√≠da:",t.length),t}}const v=new p;export{v as estoqueItensAdapter};
