var _=Object.defineProperty;var B=(o,t,r)=>t in o?_(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r;var m=(o,t,r)=>B(o,typeof t!="symbol"?t+"":t,r);import{w as c,d}from"./T8TN0H9u.js";import{ah as n}from"./BC4IzclS.js";function D(){const{subscribe:o,set:t,update:r}=c("light");return{subscribe:o,initialize:()=>{const e=localStorage.getItem("theme");if(e==="dark"||e==="light"){t(e),document.documentElement.classList.toggle("dark",e==="dark");return}const s=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";t(s),document.documentElement.classList.toggle("dark",s==="dark")},toggle:()=>{r(e=>{const a=e==="light"?"dark":"light";return localStorage.setItem("theme",a),document.documentElement.classList.toggle("dark",a==="dark"),a})},set:e=>{localStorage.setItem("theme",e),document.documentElement.classList.toggle("dark",e==="dark"),t(e)}}}const Z=D(),P={tiposMovimentacao:[{code:"entrada_nota",label:"Entrada por Nota",description:"Entrada de itens via nota fiscal"},{code:"saida_entrega",label:"Saída por Entrega",description:"Saída para entrega a colaborador"},{code:"transferencia",label:"Transferência",description:"Transferência entre almoxarifados"},{code:"ajuste_positivo",label:"Ajuste Positivo",description:"Ajuste para aumentar estoque"},{code:"ajuste_negativo",label:"Ajuste Negativo",description:"Ajuste para diminuir estoque"},{code:"devolucao",label:"Devolução",description:"Devolução de item por colaborador"},{code:"descarte",label:"Descarte",description:"Descarte de item vencido ou danificado"},{code:"estorno",label:"Estorno",description:"Estorno de movimentação anterior"}],categoriasEPI:[{code:"protecao_cabeca",label:"Proteção da Cabeça",description:"Capacetes, bonés, etc."},{code:"protecao_olhos",label:"Proteção dos Olhos",description:"Óculos, viseiras, etc."},{code:"protecao_auditiva",label:"Proteção Auditiva",description:"Protetores auriculares"},{code:"protecao_respiratoria",label:"Proteção Respiratória",description:"Máscaras, respiradores"},{code:"protecao_tronco",label:"Proteção do Tronco",description:"Aventais, coletes, jaquetas"},{code:"protecao_maos",label:"Proteção das Mãos",description:"Luvas de diversos tipos"},{code:"protecao_pes",label:"Proteção dos Pés",description:"Calçados de segurança"},{code:"protecao_queda",label:"Proteção contra Quedas",description:"Cintos, talabartes, etc."}],statusEntrega:[{code:"pendente_assinatura",label:"Pendente de Assinatura",description:"Aguardando assinatura do colaborador"},{code:"assinada",label:"Assinada",description:"Entrega confirmada e assinada"},{code:"devolvido",label:"Devolvido",description:"Item devolvido pelo colaborador"},{code:"vencido",label:"Vencido",description:"Item vencido e deve ser substituído"},{code:"cancelada",label:"Cancelada",description:"Entrega cancelada"}],statusFicha:[{code:"ativa",label:"Ativa",description:"Ficha ativa do colaborador"},{code:"inativa",label:"Inativa",description:"Ficha inativada"},{code:"pendente",label:"Pendente",description:"Ficha com pendências"},{code:"completa",label:"Completa",description:"Ficha com todos os EPIs entregues"}],statusEstoque:[{code:"disponivel",label:"Disponível",description:"Item disponível em estoque"},{code:"baixo",label:"Estoque Baixo",description:"Quantidade abaixo do mínimo"},{code:"vencendo",label:"Próximo ao Vencimento",description:"Vence em até 30 dias"},{code:"vencido",label:"Vencido",description:"Item com validade expirada"},{code:"esgotado",label:"Esgotado",description:"Sem itens em estoque"},{code:"bloqueado",label:"Bloqueado",description:"Item bloqueado para uso"}],tiposNota:[{code:"entrada",label:"Entrada",description:"Nota de entrada de mercadorias"},{code:"transferencia",label:"Transferência",description:"Nota de transferência"},{code:"devolucao",label:"Devolução",description:"Nota de devolução"},{code:"descarte",label:"Descarte",description:"Nota de descarte"}]};class O{constructor(){m(this,"cache",null);m(this,"cacheExpiry",0);m(this,"CACHE_DURATION",5*60*1e3)}async loadBusinessRules(){if(this.cache&&Date.now()<this.cacheExpiry)return this.cache;try{await new Promise(r=>setTimeout(r,100));const t=P;return this.cache=t,this.cacheExpiry=Date.now()+this.CACHE_DURATION,t}catch(t){return console.error("Erro ao carregar configurações de negócio:",t),this.cache?(console.warn("Usando configurações do cache devido ao erro"),this.cache):(console.warn("Usando configurações mock devido ao erro"),P)}}async getConfigByCategory(t){return(await this.loadBusinessRules())[t]||[]}async getConfigItem(t,r){return(await this.getConfigByCategory(t)).find(a=>a.code===r)||null}clearCache(){this.cache=null,this.cacheExpiry=0}isCacheValid(){return this.cache!==null&&Date.now()<this.cacheExpiry}}const y=new O,I={data:null,loading:!1,error:null,lastUpdated:null};function k(){const{subscribe:o,set:t,update:r}=c(I);return{subscribe:o,async initialize(){r(e=>({...e,loading:!0,error:null}));try{const e=await y.loadBusinessRules();t({data:e,loading:!1,error:null,lastUpdated:Date.now()}),console.log("✅ Configurações de negócio carregadas com sucesso")}catch(e){const a=e instanceof Error?e.message:"Erro desconhecido";r(s=>({...s,loading:!1,error:`Erro ao carregar configurações: ${a}`})),console.error("❌ Erro ao carregar configurações de negócio:",e)}},async reload(){y.clearCache(),await this.initialize()},reset(){t(I)},isReady(){let e=!1;return o(a=>{e=a.data!==null&&!a.loading&&!a.error})(),e}}}const p=k(),N=d(p,o=>{var t;return((t=o.data)==null?void 0:t.tiposMovimentacao)||[]}),M=d(p,o=>{var t;return((t=o.data)==null?void 0:t.categoriasEPI)||[]}),F=d(p,o=>{var t;return((t=o.data)==null?void 0:t.statusEntrega)||[]});d(p,o=>{var t;return((t=o.data)==null?void 0:t.statusFicha)||[]});const R=d(p,o=>{var t;return((t=o.data)==null?void 0:t.statusEstoque)||[]});d(p,o=>{var t;return((t=o.data)==null?void 0:t.tiposNota)||[]});d(p,o=>o.data!==null&&!o.loading&&!o.error);function v(o,t=!0){const r=o.map(e=>({value:e.code,label:e.label}));return t?[{value:"",label:"Selecionar..."},...r]:r}d(N,o=>v(o));const $=d(M,o=>v(o));d(F,o=>v(o));const ee=d(R,o=>v(o));function te(o=null){const t=c({data:o,loading:!1,error:null});return{subscribe:t.subscribe,set:r=>t.update(e=>({...e,data:r,error:null})),setLoading:r=>t.update(e=>({...e,loading:r})),setError:r=>t.update(e=>({...e,error:r,loading:!1})),reset:()=>t.set({data:o,loading:!1,error:null}),execute:async r=>{t.update(e=>({...e,loading:!0,error:null}));try{const e=await r();return t.update(a=>({...a,data:e,loading:!1})),e}catch(e){const a=e instanceof Error?e.message:"Erro desconhecido";throw t.update(s=>({...s,error:a,loading:!1})),e}}}}function L(){const{subscribe:o,update:t}=c([]);return{subscribe:o,add:r=>{const e=Math.random().toString(36).substring(7),a={id:e,...r};t(i=>[...i,a]);const s=r.duration||5e3;return s>0&&setTimeout(()=>{t(i=>i.filter(h=>h.id!==e))},s),e},remove:r=>{t(e=>e.filter(a=>a.id!==r))},clear:()=>{t(()=>[])}}}const b=L(),ae={success:(o,t,r)=>b.add({type:"success",title:o,message:t,duration:r}),error:(o,t,r)=>b.add({type:"error",title:o,message:t,duration:r}),warning:(o,t,r)=>b.add({type:"warning",title:o,message:t,duration:r}),info:(o,t,r)=>b.add({type:"info",title:o,message:t,duration:r})};function E(o){const t=c(o),r=c(""),e=c(1),a=c(10),s=c(""),i=c("asc"),h=d([t,r,e,a,s,i],([l,f,g,C,w,A])=>({filters:l,search:{term:f,fields:[]},pagination:{currentPage:g,itemsPerPage:C,totalItems:0,totalPages:0},sort:{field:w,direction:A}}));return{filters:t,searchTerm:r,currentPage:e,itemsPerPage:a,sortField:s,sortDirection:i,filtersState:h,updateFilter:(l,f)=>{t.update(g=>({...g,[l]:f})),e.set(1)},setSearchTerm:l=>{r.set(l),e.set(1)},setCurrentPage:l=>{e.set(l)},setItemsPerPage:l=>{a.set(l),e.set(1)},setSorting:(l,f)=>{const g=n(i),C=n(s);l===C&&!f?i.set(g==="asc"?"desc":"asc"):(s.set(l),i.set(f||"asc"))},resetFilters:()=>{t.set(o),r.set(""),e.set(1),s.set(""),i.set("asc")},resetPagination:()=>{e.set(1)},getCurrentFilters:()=>n(t),getCurrentSearchTerm:()=>n(r),getCurrentPage:()=>n(e),getCurrentSort:()=>({field:n(s),direction:n(i)})}}const oe=E({status:"todos",categoria:"todas",fabricante:"todos"});E({status:"todos",estoque:"todos",categoria:"todas",vencimento:"todos"});E({cargo:"todos",empresa:"todas",devolucaoPendente:!1});function j(){const{subscribe:o,set:t,update:r}=c([]);return{subscribe:o,set:t,add:e=>r(a=>[...a,e]),update:(e,a)=>r(s=>s.map(i=>i.id===e?{...i,...a}:i)),remove:e=>r(a=>a.filter(s=>s.id!==e)),getById:e=>n({subscribe:o}).find(a=>a.id===e),clear:()=>t([])}}function U(){const{subscribe:o,set:t,update:r}=c([]);return{subscribe:o,set:t,add:e=>r(a=>[...a,e]),update:(e,a)=>r(s=>s.map(i=>i.id===e?{...i,...a}:i)),remove:e=>r(a=>a.filter(s=>s.id!==e)),updateQuantidade:(e,a)=>r(s=>s.map(i=>i.id===e?{...i,quantidade:a}:i)),getById:e=>n({subscribe:o}).find(a=>a.id===e),getByTipoEPI:e=>n({subscribe:o}).filter(a=>a.tipoEPIId===e),clear:()=>t([])}}function V(){const{subscribe:o,set:t,update:r}=c([]);return{subscribe:o,set:t,add:e=>r(a=>[...a,e]),update:(e,a)=>r(s=>s.map(i=>i.id===e?{...i,...a}:i)),remove:e=>r(a=>a.filter(s=>s.id!==e)),getById:e=>n({subscribe:o}).find(a=>a.id===e),getByColaborador:e=>n({subscribe:o}).filter(a=>a.colaboradorId===e),getAtivas:()=>n({subscribe:o}).filter(e=>e.status==="ativo"),getVencidas:()=>n({subscribe:o}).filter(e=>e.status==="vencido"),clear:()=>t([])}}function z(){const{subscribe:o,set:t,update:r}=c([]);return{subscribe:o,set:t,add:e=>r(a=>[...a,e]),update:(e,a)=>r(s=>s.map(i=>i.id===e?{...i,...a}:i)),remove:e=>r(a=>a.filter(s=>s.id!==e)),getById:e=>n({subscribe:o}).find(a=>a.id===e),getByEmpresa:e=>n({subscribe:o}).filter(a=>a.empresaId===e),getAtivos:()=>n({subscribe:o}).filter(e=>e.status==="ativo"),clear:()=>t([])}}function Q(){const{subscribe:o,set:t,update:r}=c([]);return{subscribe:o,set:t,add:e=>r(a=>[...a,e]),update:(e,a)=>r(s=>s.map(i=>i.id===e?{...i,...a}:i)),remove:e=>r(a=>a.filter(s=>s.id!==e)),getById:e=>n({subscribe:o}).find(a=>a.id===e),getAtivas:()=>n({subscribe:o}).filter(e=>e.status==="ativa"),clear:()=>t([])}}function H(){const{subscribe:o,set:t,update:r}=c([]);return{subscribe:o,set:t,add:e=>r(a=>[...a,e]),update:(e,a)=>r(s=>s.map(i=>i.id===e?{...i,...a}:i)),remove:e=>r(a=>a.filter(s=>s.id!==e)),getById:e=>n({subscribe:o}).find(a=>a.id===e),getByFicha:e=>n({subscribe:o}).filter(a=>a.fichaEPIId===e),getPendentes:()=>n({subscribe:o}).filter(e=>e.status==="nao_assinado"||e.status==="pendente"),clear:()=>t([])}}function G(){const{subscribe:o,set:t,update:r}=c([]);return{subscribe:o,set:t,add:e=>r(a=>[e,...a]),update:(e,a)=>r(s=>s.map(i=>i.id===e?{...i,...a}:i)),remove:e=>r(a=>a.filter(s=>s.id!==e)),markAsRead:e=>r(a=>a.map(s=>s.id===e?{...s,lida:!0}:s)),markAllAsRead:()=>r(e=>e.map(a=>({...a,lida:!0}))),getNaoLidas:()=>n({subscribe:o}).filter(e=>!e.lida),getByTipo:e=>n({subscribe:o}).filter(a=>a.tipo===e),clear:()=>t([])}}j();const S=U(),T=V(),x=z();Q();H();const K=G();d(S,o=>o.filter(t=>t.quantidade>0&&t.status==="disponivel"));d(S,o=>o.filter(t=>t.quantidadeMinima&&t.quantidade<=t.quantidadeMinima));d(T,o=>o.filter(t=>t.status==="vencido"));d(x,o=>o.filter(t=>t.status==="ativo"));const q=d(K,o=>o.filter(t=>!t.lida));d(q,o=>o.length);d([S,T,x,q],([o,t,r,e])=>({totalEstoque:o.reduce((a,s)=>a+s.quantidade,0),fichasAtivas:t.filter(a=>a.status==="ativo").length,fichasVencidas:t.filter(a=>a.status==="vencido").length,colaboradoresAtivos:r.filter(a=>a.status==="ativo").length,notificacoesPendentes:e.length,estoqueComProblemas:o.filter(a=>a.status==="baixo_estoque"||a.status==="vencido"||a.status==="esgotado").length}));function u(){const{subscribe:o,set:t,update:r}=c({isOpen:!1,mode:"create",data:void 0});return{subscribe:o,open:(e="create",a)=>{t({isOpen:!0,mode:e,data:a})},close:()=>{t({isOpen:!1,mode:"create",data:void 0})},setData:e=>{r(a=>({...a,data:e}))},setMode:e=>{r(a=>({...a,mode:e}))},isOpen:()=>n({subscribe:o}).isOpen,isMode:e=>n({subscribe:o}).mode===e,getData:()=>n({subscribe:o}).data}}u();u();u();u();u();u();u();u();function J(){const{subscribe:o,set:t,update:r}=c({isOpen:!1,title:"",message:"",confirmText:"Confirmar",cancelText:"Cancelar",confirmColor:"red"});return{subscribe:o,confirm:e=>{t({isOpen:!0,title:e.title,message:e.message,confirmText:e.confirmText||"Confirmar",cancelText:e.cancelText||"Cancelar",confirmColor:e.confirmColor||"red",onConfirm:e.onConfirm,onCancel:e.onCancel})},close:()=>{t({isOpen:!1,title:"",message:"",confirmText:"Confirmar",cancelText:"Cancelar",confirmColor:"red"})},handleConfirm:async()=>{const e=n({subscribe:o});e.onConfirm&&await e.onConfirm(),t({isOpen:!1,title:"",message:"",confirmText:"Confirmar",cancelText:"Cancelar",confirmColor:"red"})},handleCancel:()=>{const e=n({subscribe:o});e.onCancel&&e.onCancel(),t({isOpen:!1,title:"",message:"",confirmText:"Confirmar",cancelText:"Cancelar",confirmColor:"red"})}}}const re=J();export{$ as a,p as b,te as c,b as d,oe as e,re as f,ae as n,ee as s,Z as t};
