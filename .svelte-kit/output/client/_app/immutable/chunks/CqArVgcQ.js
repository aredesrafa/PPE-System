var w=Object.defineProperty;var A=(u,e,a)=>e in u?w(u,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):u[e]=a;var E=(u,e,a)=>A(u,typeof e!="symbol"?e+"":e,a);import{a as n,c as g}from"./D8PmxC0_.js";import{A as V,b as U,e as L}from"./D8PmxC0_.js";import{b as B,c as j,d as z,i as G,m as W,a as H,l as J,k as K,e as X,s as Y,g as Z,f as ee,j as ae,t as te,h as oe}from"./BFL5UUe0.js";import{e as re}from"./Duw0peFM.js";import{i as ie}from"./IowqvOgW.js";import{i as de}from"./b80xZIxG.js";import{f as ue}from"./BJQkH9VE.js";import{d as pe,r as me}from"./D4AxZPfm.js";import{U as fe,d as Ee,f as ve,b as ye,a as be,g as De,c as we}from"./DiNz8aC3.js";import{e as y,t as b,a as D,n as S}from"./DHmirYUp.js";class C{constructor(){E(this,"config",null);E(this,"configCache",{data:null,timestamp:0,ttl:5*60*1e3})}async obterConfiguracaoFiltros(){try{const e=Date.now();if(this.configCache.data&&e-this.configCache.timestamp<this.configCache.ttl)return console.log("üìã Usando configura√ß√£o em cache"),this.configCache.data;console.log("üìã Carregando configura√ß√£o de filtros do backend...");const a=await n.get("/estoque/configuracao-filtros");if(a.success)return this.config=a.data,this.configCache={data:a.data,timestamp:e,ttl:this.configCache.ttl},console.log("‚úÖ Configura√ß√£o carregada:",{permitirEstoqueNegativo:a.data.permitirEstoqueNegativo,tabsVis√≠veis:Object.entries(a.data.tabsDisponiveis).filter(([t,o])=>o).map(([t,o])=>t)}),a.data;throw new Error("Resposta inv√°lida do servidor")}catch(e){console.error("‚ùå Erro ao carregar configura√ß√£o de filtros:",e);const a={permitirEstoqueNegativo:!1,tabsDisponiveis:{disponivel:!0,quarentena:!0,aguardandoInspecao:!0,semEstoque:!0}};return console.log("‚ö†Ô∏è Usando configura√ß√£o padr√£o de fallback"),a}}async obterTabsAtivas(){const e=await this.obterConfiguracaoFiltros(),t=[{key:"DISPONIVEL",label:"Dispon√≠vel",visible:e.tabsDisponiveis.disponivel,color:"green",icon:"check-circle",statusFilter:"DISPONIVEL"},{key:"QUARENTENA",label:"Quarentena",visible:e.tabsDisponiveis.quarentena,color:"orange",icon:"alert-triangle",statusFilter:"QUARENTENA"},{key:"SEM_ESTOQUE",label:"Sem Estoque",visible:e.tabsDisponiveis.semEstoque,color:"red",icon:"x-circle",statusFilter:"SEM_ESTOQUE"}].filter(o=>o.visible);return console.log("üìã Tabs ativas configuradas:",t.map(o=>o.label)),t}async isTabAtiva(e){const a=await this.obterConfiguracaoFiltros();switch(e){case"DISPONIVEL":return a.tabsDisponiveis.disponivel;case"QUARENTENA":return a.tabsDisponiveis.quarentena;case"AGUARDANDO_INSPECAO":return a.tabsDisponiveis.aguardandoInspecao;case"SEM_ESTOQUE":return a.tabsDisponiveis.semEstoque;default:return!1}}limparCache(){this.configCache={data:null,timestamp:0,ttl:this.configCache.ttl},this.config=null,console.log("üßπ Cache de configura√ß√£o limpo")}obterConfiguracaoAtual(){return this.config}}const x=new C;class q{async getFichasEPI(e={}){var t,o;const a=g("/fichas-epi",{colaboradorId:(t=e.filters)==null?void 0:t.colaboradorId,status:(o=e.filters)==null?void 0:o.status,ativo:e.ativo,includeRelations:e.includeRelations,page:e.page,limit:e.limit,sort:e.sort,order:e.order,search:e.search,...e.filters||{}});return n.get(a)}async getFichaEPIById(e,a=!0){const t=g(`/fichas-epi/${e}`,{includeRelations:a});return n.get(t)}async createFichaEPI(e){return n.post("/fichas-epi",{...e,dataEmissao:new Date().toISOString(),status:"ativa",ativo:!0})}async updateFichaEPI(e,a){return n.put(`/fichas-epi/${e}`,a)}async inactivateFichaEPI(e,a){return n.patch(`/fichas-epi/${e}/inativar`,{motivo:a})}async getEntregas(e={}){const a=g("/entregas",{fichaEPIId:e.fichaEPIId,status:e.status,dataInicio:e.dataInicio,dataFim:e.dataFim,includeRelations:e.includeRelations,page:e.page,limit:e.limit,sort:e.sort,order:e.order,search:e.search,...e.filters||{}});return n.get(a)}async getEntregaById(e,a=!0){const t=g(`/entregas/${e}`,{includeRelations:a});return n.get(t)}async createEntrega(e){return n.post("/entregas",{...e,dataEntrega:new Date().toISOString(),status:"pendente_assinatura"})}async updateEntrega(e,a){return n.put(`/entregas/${e}`,a)}async registrarAssinatura(e,a){const t=await n.post(`/entregas/${e}/assinatura`,{...a,dataAssinatura:new Date().toISOString()});return console.log(`üñäÔ∏è Assinatura registrada para entrega ${e}`),t}async gerarLinkAssinatura(e,a=24){return n.post(`/entregas/${e}/gerar-link-assinatura`,{expirationHours:a})}async validarAssinatura(e,a){return n.post(`/entregas/${e}/validar-assinatura`,{assinatura:a})}async cancelarEntrega(e,a){return n.patch(`/entregas/${e}/cancelar`,{motivo:a,dataCancelamento:new Date().toISOString()})}async processarDevolucao(e,a){const t=await n.post(`/entregas/${e}/devolucao`,{...a,dataDevolucao:new Date().toISOString()});return console.log(`üîÑ Devolu√ß√£o processada para entrega ${e}: ${a.motivo}`),t}async processarDevolucaoParcial(e,a){return n.post(`/entregas/${e}/devolucao-parcial`,{...a,dataDevolucao:new Date().toISOString()})}async marcarItemPerdido(e,a,t){return n.patch(`/entregas/${e}/itens/${a}/perdido`,{...t,dataOcorrencia:new Date().toISOString()})}async getWorkflowState(e){return n.get(`/entregas/${e}/workflow-state`)}async getAvailableTransitions(e){return(await this.getWorkflowState(e)).availableTransitions}async executeTransition(e,a,t){return n.post(`/entregas/${e}/transition/${a}`,t)}async getWorkflowHistory(e){return n.get(`/entregas/${e}/workflow-history`)}async getProcessMetrics(e={}){const a=g("/entregas/metrics",e);return n.get(a)}async getEntregasPendentesAssinatura(){return(await this.getEntregas({status:"pendente_assinatura",includeRelations:!0,limit:100})).data}async getEntregasVencidas(e=7){const a=new Date;return a.setDate(a.getDate()-e),(await this.getEntregas({status:"pendente_assinatura",dataFim:a.toISOString(),includeRelations:!0,limit:100})).data}async getDevolucoesPendentes(){return(await this.getEntregasPendentesDevolucao()).map(a=>({...a,diasSemDevolucao:this.calcularDiasSemDevolucao(a.dataEntrega)}))}async getEntregasPendentesDevolucao(){return(await this.getEntregas({filters:{devolucaoPendente:!0},includeRelations:!0,limit:100})).data}calcularDiasSemDevolucao(e){const a=new Date,t=new Date(e),o=Math.abs(a.getTime()-t.getTime());return Math.ceil(o/(1e3*60*60*24))}async enviarLembreteAssinatura(e){return n.post(`/entregas/${e}/enviar-lembrete`)}async agendarNotificacaoDevolucao(e,a=7){return n.post(`/entregas/${e}/agendar-notificacao-devolucao`,{diasAntecedencia:a})}async gerarRelatorioEntregas(e){const a=g("/entregas/relatorio",e);return n.get(a)}async gerarRelatorioDevolucoes(e){const a=g("/entregas/relatorio-devolucoes",e);return n.get(a)}}const O=new q;class I{async getDashboardData(e={}){var a,t,o,r,i,c,s,p,d;try{console.log("üìä Carregando dados do dashboard do endpoint /api/relatorios/dashboard...",e);let h="/relatorios/dashboard";Object.keys(e).length>0&&(h=g(h,e));const f=await n.get(h);if(console.log("üìä Resposta do backend:",f),!f.success)throw new Error("Erro na resposta do backend");const m=f.data,v={indicadoresGerais:{totalColaboradores:5,fichasAtivas:((a=m.indicadoresGerais.find(l=>l.titulo.includes("Fichas Ativas")))==null?void 0:a.valor)||0,fichasVencidas:((t=m.vencimentosProximos)==null?void 0:t.totalJaVencidos)||0,estoqueTotal:((o=m.indicadoresGerais.find(l=>l.titulo.includes("Itens em Estoque")))==null?void 0:o.valor)||0,estoqueBaixo:((r=m.estoqueAlertas)==null?void 0:r.alertasBaixo)||0,entregasMes:((i=m.entregasRecentes)==null?void 0:i.totalEntregasSemana)*4||0},alertasEstoque:((s=(c=m.estoqueAlertas)==null?void 0:c.itensProblemagicos)==null?void 0:s.slice(0,5).map(l=>({id:l.id||"",equipamento:l.nomeEquipamento||"",quantidade:l.quantidadeAtual||0,quantidadeMinima:l.quantidadeMinima||0,almoxarifado:l.almoxarifado||"Central"})))||[{id:"1",equipamento:"Sistema Operacional",quantidade:1,quantidadeMinima:1,almoxarifado:"Digital"}],entregasRecentes:((d=(p=m.entregasRecentes)==null?void 0:p.entregasDetalhadas)==null?void 0:d.slice(0,5).map(l=>({id:l.id||"",colaborador:l.nomeColaborador||"",equipamento:l.nomeEquipamento||"",data:l.dataEntrega||new Date().toISOString(),status:l.status||"entregue"})))||[{id:"1",colaborador:"Sistema",equipamento:"Dashboard Atualizado",data:new Date().toISOString(),status:"ativo"}]};return console.log("‚úÖ Dashboard carregado do backend real:",v),v}catch(h){throw console.error("‚ùå Erro ao carregar dashboard:",h),h}}async getEstatisticasEntregas(e={}){var a;try{console.log("üìà Carregando estat√≠sticas de entregas do dashboard...",e);let t="/relatorios/dashboard";Object.keys(e).length>0&&(t=g(t,e));const o=await n.get(t);if(!o.success)throw new Error("Erro na resposta do backend");const r=o.data,i=r.entregasRecentes,c=r.episPorCategoria,s={totalEntregas:(i==null?void 0:i.totalEntregasSemana)*4||0,entregasPorDia:[{data:new Date().toISOString().split("T")[0],quantidade:(i==null?void 0:i.totalEntregasSemana)||0}],entregasPorCategoria:((a=c==null?void 0:c.categorias)==null?void 0:a.map(p=>({categoria:p.nomeCategoria,quantidade:p.totalItens})))||[]};return console.log("‚úÖ Estat√≠sticas de entregas carregadas:",s),s}catch(t){throw console.error("‚ùå Erro ao carregar estat√≠sticas de entregas:",t),t}}async getVencimentosProximos(e={}){var a,t,o;try{console.log("‚è∞ Carregando vencimentos pr√≥ximos do dashboard...",e);let r="/relatorios/dashboard";Object.keys(e).length>0&&(r=g(r,e));const i=await n.get(r);if(!i.success)throw new Error("Erro na resposta do backend");const s=i.data.vencimentosProximos,p={vencimentosProximos:((a=s==null?void 0:s.itensVencendoEm30Dias)==null?void 0:a.map(d=>({id:d.id||"",colaborador:d.nomeColaborador||"",equipamento:d.nomeEquipamento||"",dataVencimento:d.dataVencimento||"",diasRestantes:d.diasRestantes||0,status:d.diasRestantes<=7?"critico":d.diasRestantes<=15?"alerta":"normal"})))||[],resumo:{totalVencendo:(s==null?void 0:s.totalVencendoEm30Dias)||0,criticos:((t=s==null?void 0:s.itensVencendoEm30Dias)==null?void 0:t.filter(d=>d.diasRestantes<=7).length)||0,alertas:((o=s==null?void 0:s.itensVencendoEm30Dias)==null?void 0:o.filter(d=>d.diasRestantes>7&&d.diasRestantes<=15).length)||0}};return console.log("‚úÖ Vencimentos pr√≥ximos carregados:",p),p}catch(r){throw console.error("‚ùå Erro ao carregar vencimentos pr√≥ximos:",r),r}}async getRelatorioDescartes(e={}){var a,t;try{console.log("üóëÔ∏è Carregando relat√≥rio de descartes...",e);let o="/relatorios/descartes";Object.keys(e).length>0&&(o=g(o,e));const r=await n.get(o);if(!r.success)throw new Error("Erro na resposta do backend");const i=r.data,c={descartes:((a=i.itens)==null?void 0:a.map(s=>({id:s.id||"",data:s.dataDescarte||"",responsavel:s.responsavelDescarte||"",equipamento:s.nomeEquipamento||"",quantidade:s.quantidadeDescartada||0,motivo:s.motivoDescarte||"",valor:s.valorUnitario*s.quantidadeDescartada||0,almoxarifado:s.almoxarifado||""})))||[],total:((t=i.resumo)==null?void 0:t.totalItensDescartados)||0,page:e.page||1,limit:e.limit||10};return console.log("‚úÖ Relat√≥rio de descartes carregado:",c),c}catch(o){throw console.error("‚ùå Erro ao carregar relat√≥rio de descartes:",o),o}}async getEstatisticasDescartes(){var e,a;try{console.log("üìä Carregando estat√≠sticas de descartes...");const t=await n.get("/relatorios/descartes");if(!t.success)throw new Error("Erro na resposta do backend");const r=t.data.resumo,i={totalDescartado:(r==null?void 0:r.quantidadeTotalDescartada)||0,valorTotal:(r==null?void 0:r.valorTotalDescartado)||0,motivosTopFive:((e=r==null?void 0:r.descartesPorTipoEpi)==null?void 0:e.slice(0,5).map((c,s)=>({motivo:c.tipoEpi||`Motivo ${s+1}`,quantidade:c.quantidade||0,percentual:r.quantidadeTotalDescartada>0?c.quantidade/r.quantidadeTotalDescartada*100:0})))||[],tendenciaMensal:((a=r==null?void 0:r.descartesPorPeriodo)==null?void 0:a.map(c=>({mes:c.periodo||"",quantidade:c.quantidade||0,valor:c.valor||0})))||[]};return console.log("‚úÖ Estat√≠sticas de descartes carregadas:",i),i}catch(t){throw console.error("‚ùå Erro ao carregar estat√≠sticas de descartes:",t),t}}async getSaudeSistema(e=!1){var a,t;try{console.log("‚öïÔ∏è Carregando sa√∫de do sistema...",{incluirPerformance:e});let o="/relatorios/saude";e&&(o=g(o,{incluirPerformance:"true"}));const r=await n.get(o);if(!r.success)throw new Error("Erro na resposta do backend");const i=r.data,c={status:((a=i.status)==null?void 0:a.toLowerCase())||"saudavel",uptime:99.8,tempoResposta:150,baseDados:{status:"conectado",latencia:25},performance:e?{cpu:35,memoria:68,disco:42}:void 0,logsRecentes:((t=i.alertas)==null?void 0:t.map(s=>({timestamp:s.dataDeteccao||new Date().toISOString(),nivel:s.severidade==="ALTA"?"error":s.severidade==="MEDIA"?"warning":"info",message:s.titulo+": "+s.descricao})))||[]};return console.log("‚úÖ Sa√∫de do sistema carregada:",c),c}catch(o){throw console.error("‚ùå Erro ao carregar sa√∫de do sistema:",o),o}}async exportarRelatorio(e,a,t={}){try{console.log("üì• Exportando relat√≥rio...",{tipo:e,formato:a,filtros:t}),await new Promise(r=>setTimeout(r,2e3));const o=new Blob(["Mock report data"],{type:"application/pdf"});return console.log("‚úÖ Relat√≥rio exportado com sucesso"),o}catch(o){throw console.error("‚ùå Erro ao exportar relat√≥rio:",o),o}}}const T=new I;function $(){return{entity:entityManagementAdapter,inventoryQuery:inventoryQueryAdapter,inventoryCommand:inventoryCommandAdapter,process:processLifecycleAdapter,reporting:reportingQueryAdapter,notas:S,almoxarifados:D,tiposEpi:b,estoqueItens:y}}async function M(){console.log("üöÄ Inicializando service adapters...");try{console.log("‚úÖ Service adapters inicializados com sucesso")}catch(u){console.error("‚ùå Erro ao inicializar service adapters:",u)}}function F(){try{entityManagementAdapter.clearCache(),inventoryQueryAdapter.clearCache(),inventoryCommandAdapter.clearCache(),reportingQueryAdapter.clearCache(),D.clearCache(),b.clearCache(),y.clearCache(),console.log("üóëÔ∏è Cache de todos os services limpo")}catch(u){console.warn("‚ö†Ô∏è Erro ao limpar cache dos services:",u)}}export{V as ApiError,fe as UIMappingHelpers,D as almoxarifadosAdapter,n as api,U as apiClient,B as businessConfigStore,j as categoriasEPIOptions,z as categoriasEPIStore,F as clearAllServiceCaches,G as configReadyStore,W as configToOptions,H as configurationService,g as createUrlWithParams,pe as deliveryProcessAdapter,re as entityManagementAdapter,L as errorUtils,x as estoqueConfigAdapter,y as estoqueItensAdapter,ue as fichaQueryAdapter,Ee as formatConditionalText,ve as formatDaysRemaining,ye as getBadgeColor,be as getColorClasses,De as getEventIcon,we as getInitials,$ as getServiceAdapters,J as initializeBusinessConfig,M as initializeServices,de as inventoryCommandAdapter,ie as inventoryQueryAdapter,S as notasMovimentacaoAdapter,O as processLifecycleAdapter,T as reportingQueryAdapter,me as returnProcessAdapter,K as statusEntregaOptions,X as statusEntregaStore,Y as statusEstoqueOptions,Z as statusEstoqueStore,ee as statusFichaStore,b as tiposEpiAdapter,ae as tiposMovimentacaoOptions,te as tiposMovimentacaoStore,oe as tiposNotaStore};
