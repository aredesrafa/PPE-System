var f=Object.defineProperty;var h=(p,t,e)=>t in p?f(p,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):p[t]=e;var A=(p,t,e)=>h(p,typeof t!="symbol"?t+"":t,e);import{a as d}from"./Dwq3Do7L.js";class v{constructor(){A(this,"transformFichaBasica",t=>{var e,o,a,s,i,n,u,r,c,l,m,E;return{id:t.id||"",status:t.status||"inativa",statusDisplay:this.transformStatusDisplay(t.status),colaborador:{nome:((e=t.colaborador)==null?void 0:e.nome)||"",cpf:((o=t.colaborador)==null?void 0:o.cpf)||"",cpfDisplay:this.formatCPF(((a=t.colaborador)==null?void 0:a.cpf)||""),matricula:((s=t.colaborador)==null?void 0:s.matricula)||"",cargo:((i=t.colaborador)==null?void 0:i.cargo)||"",empresa:((n=t.contratada)==null?void 0:n.nome)||((u=t.colaborador)==null?void 0:u.empresa)||"",iniciais:this.extractInitials(((r=t.colaborador)==null?void 0:r.nome)||"")},estatisticas:{totalEntregas:((c=t.estatisticas)==null?void 0:c.totalEntregas)||0,itensAtivos:t.totalEpisAtivos||((l=t.estatisticas)==null?void 0:l.itensAtivos)||0,devolucoesPendentes:((m=t.estatisticas)==null?void 0:m.devolucoesPendentes)||0},totalEpisAtivos:t.totalEpisAtivos||((E=t.estatisticas)==null?void 0:E.itensAtivos)||0,dataAtualizacao:t.dataAtualizacao||t.createdAt||new Date().toISOString()}})}transformFichasList(t){var o,a,s,i,n,u,r;return!(t!=null&&t.success)||!((o=t==null?void 0:t.data)!=null&&o.items)||!Array.isArray(t.data.items)?(console.log("‚ùå Transform: Invalid data structure"),{items:[],total:0,page:1,pageSize:10,totalPages:0}):{items:t.data.items.map(this.transformFichaBasica),total:((a=t.data.pagination)==null?void 0:a.total)||t.data.items.length,page:((s=t.data.pagination)==null?void 0:s.page)||1,pageSize:((i=t.data.pagination)==null?void 0:i.limit)||10,totalPages:((n=t.data.pagination)==null?void 0:n.totalPages)||Math.ceil((((u=t.data.pagination)==null?void 0:u.total)||t.data.items.length)/(((r=t.data.pagination)==null?void 0:r.limit)||10))}}transformSearchResults(t){var e;return(e=t==null?void 0:t.data)!=null&&e.items?t.data.items.map(this.transformFichaBasica):[]}transformStatusDisplay(t){return{ativa:{cor:"green",label:"Ativa"},inativa:{cor:"gray",label:"Inativa"},vencida:{cor:"red",label:"Vencida"},pendente_devolucao:{cor:"yellow",label:"Pendente Devolu√ß√£o"}}[t]||{cor:"gray",label:"Indefinido"}}formatCPF(t){if(!t)return"";const e=t.replace(/\D/g,"");return e.length!==11?t:e.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4")}extractInitials(t){return t?t.split(" ").filter(e=>e.length>0).map(e=>e[0].toUpperCase()).slice(0,2).join(""):""}transformFichaComplete(t){if(!(t!=null&&t.success)||!(t!=null&&t.data))throw new Error("Dados de ficha completa inv√°lidos");const e=t.data;return{success:!0,data:{ficha:e.ficha||{},entregas:this.transformEntregas(e.entregas||[]),devolucoes:this.extractDevolucoes(e.historico||[]),equipamentosEmPosse:e.equipamentosEmPosse||[],historico:this.transformHistorico(e.historico||[]),estatisticas:e.estatisticas||{}}}}transformEntregas(t){return t.map(e=>{var o;return{...e,numero:e.id||"",dataEntrega:this.formatDate(e.dataEntrega),statusDisplay:this.transformStatusEntrega(e.status),acoes:this.getAcoesEntrega(e.status),itens:((o=e.itens)==null?void 0:o.map(a=>{var s,i,n;return{...a,quantidade:a.quantidadeEntregue||1,nomeEquipamento:((s=e.tipoEpi)==null?void 0:s.nome)||"EPI n√£o identificado",numeroCA:((i=e.tipoEpi)==null?void 0:i.codigo)||"",registroCA:((n=e.tipoEpi)==null?void 0:n.codigo)||""}}))||[]}})}transformHistorico(t){return t.map(e=>{var o;return{...e,dataFormatada:this.formatDate(e.dataAcao),tipoDisplay:{tipo:e.tipoAcao,label:this.getTipoEventoLabel(e.tipoAcao),cor:this.getTipoEventoCor(e.tipoAcao)},acao:e.descricao||"",responsavel:((o=e.responsavel)==null?void 0:o.nome)||"Sistema",detalhes:{resumo:e.descricao||""}}})}transformStatusEntrega(t){return{PENDENTE_ASSINATURA:{cor:"yellow",label:"Pendente Assinatura"},ASSINADA:{cor:"green",label:"Assinada"},CANCELADA:{cor:"red",label:"Cancelada"},RASCUNHO:{cor:"gray",label:"Rascunho"}}[t]||{cor:"gray",label:t}}getAcoesEntrega(t){switch(t){case"PENDENTE_ASSINATURA":return["assinar","editar","imprimir"];case"ASSINADA":return["imprimir"];case"RASCUNHO":return["editar"];default:return["imprimir"]}}formatDate(t){if(!t)return"";try{return new Date(t).toLocaleDateString("pt-BR")}catch{return t}}getTipoEventoLabel(t){return{CRIACAO:"Cria√ß√£o",ENTREGA:"Entrega",DEVOLUCAO:"Devolu√ß√£o",EDICAO:"Edi√ß√£o",CANCELAMENTO:"Cancelamento",ALTERACAO_STATUS:"Altera√ß√£o de Status",ITEM_VENCIDO:"Item Vencido"}[t]||t}getTipoEventoCor(t){return{CRIACAO:"blue",ENTREGA:"green",DEVOLUCAO:"orange",EDICAO:"yellow",CANCELAMENTO:"red",ALTERACAO_STATUS:"purple",ITEM_VENCIDO:"red"}[t]||"gray"}extractDevolucoes(t){return t.filter(o=>o.tipoAcao==="DEVOLUCAO").map(o=>{var a,s,i;return{id:o.id,nomeEquipamento:((a=o.detalhes)==null?void 0:a.tipoEpiNome)||"EPI n√£o identificado",numeroCA:"N/A",categoria:"N/A",dataDevolucao:this.formatDate(o.dataAcao),motivoDisplay:this.getMotivoDevolucao(o.descricao),status:"processada",condicaoItem:"BOM",observacoes:o.descricao||"",entregaId:((s=o.detalhes)==null?void 0:s.entregaId)||"",responsavel:((i=o.responsavel)==null?void 0:i.nome)||"Sistema"}})}getMotivoDevolucao(t){return t!=null&&t.includes("danificado")?"Item danificado":t!=null&&t.includes("troca")?"Troca de equipamento":t!=null&&t.includes("vencido")?"Item vencido":"Devolu√ß√£o padr√£o"}}const g=new v;class y{async getFichaComplete(t){var e,o,a,s,i,n,u;try{console.log("üîç Carregando ficha completa:",t);const[r,c,l]=await Promise.all([d.get(`/fichas-epi/${t}/complete`),d.get(`/fichas-epi/${t}/entregas`),d.get(`/fichas-epi/${t}/historico`)]);console.log("‚úÖ Dados b√°sicos carregados"),console.log("üì¶ Entregas encontradas:",((e=c==null?void 0:c.data)==null?void 0:e.length)||0),console.log("üìù Eventos de hist√≥rico:",((a=(o=l==null?void 0:l.data)==null?void 0:o.historico)==null?void 0:a.length)||0);const m={...r,data:{...r.data,entregas:(c==null?void 0:c.data)||[],historico:((s=l==null?void 0:l.data)==null?void 0:s.historico)||[],devolucoes:((i=r.data)==null?void 0:i.devolucoes)||[],equipamentosEmPosse:((n=r.data)==null?void 0:n.equipamentosEmPosse)||[],estatisticas:((u=r.data)==null?void 0:u.estatisticas)||{}}};return g.transformFichaComplete(m)}catch(r){throw console.error("‚ùå Erro ao buscar ficha completa:",r),r}}async getFichasList(t={}){try{const o=`/fichas-epi/list-enhanced${this.buildQueryParams(t)}`;console.log("üîç Chamando endpoint:",o);const a=await d.get(o);return g.transformFichasList(a)}catch(e){return console.error("Erro ao buscar lista de fichas:",e),{items:[],total:0,page:t.page||1,pageSize:t.limit||10,totalPages:0}}}async searchFichas(t,e=20){try{if(!(t!=null&&t.trim()))return[];const o=await d.get(`/fichas-epi/search?q=${encodeURIComponent(t)}&limit=${e}`);return g.transformSearchResults(o)}catch(o){return console.error("Erro ao buscar fichas:",o),[]}}async getFichasByEmpresa(t,e={}){return this.getFichasList({...e,empresaId:t})}async getFichasByStatus(t,e={}){return this.getFichasList({...e,status:t})}async getFichasComDevolucaoPendente(t={}){return this.getFichasList({...t,devolucaoPendente:!0})}buildQueryParams(t){var a,s,i;const e=new URLSearchParams;(a=t.search)!=null&&a.trim()&&e.set("search",t.search.trim()),t.empresaId&&e.set("empresaId",t.empresaId),(s=t.empresa)!=null&&s.trim()&&e.set("empresa",t.empresa.trim()),(i=t.cargo)!=null&&i.trim()&&e.set("cargo",t.cargo.trim()),t.status&&e.set("status",t.status),t.devolucaoPendente!==void 0&&e.set("devolucaoPendente",t.devolucaoPendente.toString()),t.page&&t.page>0&&e.set("page",t.page.toString()),t.limit&&t.limit>0&&e.set("limit",t.limit.toString());const o=e.toString();return o?`?${o}`:""}async getFichasWithColaboradores(t){console.log("üìã FichaQueryAdapter: M√©todo transit√≥rio - getFichasWithColaboradores");const e={page:t.page,limit:t.limit,search:t.searchTerm,empresa:t.empresaFilter,cargo:t.cargoFilter,status:t.statusFilter,devolucaoPendente:t.devolucaoPendente};try{const o=await this.getFichasList(e);return{fichas:o.items,total:o.total,page:o.page,pageSize:o.pageSize}}catch(o){throw console.error("‚ùå Erro no m√©todo transit√≥rio:",o),o}}async getEstatisticasGerais(){try{const t=await d.get("/fichas-epi/estatisticas");return!t.success||!t.data?{total:0,ativas:0,inativas:0,pendenteDevolucao:0}:t.data}catch(t){return console.error("Erro ao buscar estat√≠sticas:",t),{total:0,ativas:0,inativas:0,pendenteDevolucao:0}}}async getEPIsDisponiveis(){try{const t=await d.get("/estoque/itens?apenasDisponiveis=true&apenasComSaldo=true");return!t.success||!Array.isArray(t.data.items)?[]:t.data.items.map(e=>({id:e.id,nomeEquipamento:e.tipoEpi.nomeEquipamento,numeroCA:e.tipoEpi.numeroCa,categoria:e.tipoEpi.categoriaEpi,quantidadeDisponivel:e.quantidade,disponivel:e.status==="DISPONIVEL"&&e.quantidade>0,registroCA:e.tipoEpi.numeroCa,estoqueItemId:e.id,tipoEpiId:e.tipoEpi.id,posicaoEstoqueId:e.almoxarifadoId}))}catch(t){return console.error("Erro ao buscar EPIs dispon√≠veis:",t),[]}}async getFichaById(t){try{const e=await d.get(`/fichas-epi/${t}`);return e.success?e.data:null}catch(e){return console.error("Erro ao buscar ficha por ID:",e),null}}async getUsuarios(){try{const t=await d.get("/usuarios");return console.log("üîç Resposta da API /usuarios:",t),!t.items||!Array.isArray(t.items)?(console.log("‚ùå Response n√£o tem items ou items n√£o √© array:",t),[]):(console.log("‚úÖ Encontrado",t.items.length,"usu√°rios"),t.items.map(e=>({id:e.id,nome:e.nome,email:e.email,perfil:e.perfil||"usuario",ativo:e.ativo!==!1,createdAt:e.createdAt,updatedAt:e.updatedAt||e.createdAt})))}catch(t){return console.error("‚ùå Erro ao buscar usu√°rios:",t),[]}}}const b=new y;export{b as f};
