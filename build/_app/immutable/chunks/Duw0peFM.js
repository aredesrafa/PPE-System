var l=Object.defineProperty;var u=(i,t,a)=>t in i?l(i,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[t]=a;var s=(i,t,a)=>u(i,typeof t!="symbol"?t+"":t,a);import{c as r,a as e}from"./D8PmxC0_.js";class g{constructor(){s(this,"cache",new Map);s(this,"CACHE_DURATION",5*60*1e3)}async getContratadas(t={}){const a=r("/contratadas",{ativo:t.ativo,page:t.page,limit:t.limit,sort:t.sort,order:t.order});return e.get(a)}async getContratadaById(t){return e.get(`/contratadas/${t}`)}async createContratada(t){return e.post("/contratadas",t)}async updateContratada(t,a){return e.put(`/contratadas/${t}`,a)}async deleteContratada(t){return e.delete(`/contratadas/${t}`)}async getColaboradores(t={}){const a=r("/colaboradores",{contratadaId:t.contratadaId,ativo:t.ativo,includeRelations:t.includeRelations,page:t.page,limit:t.limit,sort:t.sort,order:t.order,search:t.search,...t.filters||{}});return e.get(a)}async getColaboradoresByContratada(t,a={}){const o=r("/colaboradores",{contratadaId:t,ativo:a.ativo,includeRelations:a.includeRelations,page:a.page,limit:a.limit,sort:a.sort,order:a.order});return!a.page&&!a.limit?e.get(o):(await e.get(o)).data}async getColaboradorById(t,a=!1){const o=r(`/colaboradores/${t}`,{includeRelations:a});return e.get(o)}async createColaborador(t){return e.post("/colaboradores",t)}async updateColaborador(t,a){return e.put(`/colaboradores/${t}`,a)}async deleteColaborador(t){return e.delete(`/colaboradores/${t}`)}async getTiposEPI(t={}){try{const a=await e.get("/tipos-epi",t),o=a.data.items||[];return{data:o,total:a.data.total||o.length,page:t.page||1,pageSize:t.limit||50,totalPages:Math.ceil((a.data.total||o.length)/(t.limit||50))}}catch(a){throw console.error("❌ Erro ao buscar tipos EPI:",a),a}}async getTiposEPIByCategoria(t,a={}){const o=r("/tipos-epi",{categoria:t,ativo:a.ativo,page:a.page,limit:a.limit,sort:a.sort,order:a.order});return!a.page&&!a.limit?e.get(o):(await e.get(o)).data}async getTipoEPIById(t){return e.get(`/tipos-epi/${t}`)}async getTipoEPIByCA(t){try{const a=r("/tipos-epi/search",{numeroCA:t});return await e.get(a)}catch{return null}}async createTipoEPI(t){return e.post("/tipos-epi",t)}async updateTipoEPI(t,a){return e.put(`/tipos-epi/${t}`,a)}async deleteTipoEPI(t){return e.delete(`/tipos-epi/${t}`)}async getAlmoxarifados(t={}){try{const a=[{id:"1",nome:"Almoxarifado Central",localizacao:"Setor A - Galpão 1",ativo:!0,unidadeNegocioId:"1",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"2",nome:"Almoxarifado Secundário",localizacao:"Setor B - Galpão 2",ativo:!0,unidadeNegocioId:"1",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"3",nome:"Almoxarifado Obras",localizacao:"Canteiro - Container 1",ativo:!0,unidadeNegocioId:"1",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}];let o=a;return t.ativo!==void 0&&(o=a.filter(n=>n.ativo===t.ativo)),o}catch(a){throw console.error("❌ Erro ao buscar almoxarifados:",a),a}}async getAlmoxarifadoById(t){return e.get(`/almoxarifados/${t}`)}async createAlmoxarifado(t){return e.post("/almoxarifados",t)}async updateAlmoxarifado(t,a){return e.put(`/almoxarifados/${t}`,a)}async deleteAlmoxarifado(t){return e.delete(`/almoxarifados/${t}`)}async getContratadaWithColaboradores(t){const[a,o]=await Promise.all([this.getContratadaById(t),this.getColaboradoresByContratada(t,{ativo:!0})]);return{...a,colaboradores:o}}async getContratadasWithStats(){const t=await this.getContratadas({ativo:!0});return await Promise.all(t.map(async o=>{const n=await this.getColaboradoresByContratada(o.id),d=n.filter(c=>c.ativo);return{...o,totalColaboradores:n.length,colaboradoresAtivos:d.length}}))}async getTiposEPIMaisUtilizados(t=10){const a=r("/tipos-epi/mais-utilizados",{limit:t});return e.get(a)}async getContratadasCached(){const t="contratadas_ativas",a=this.cache.get(t);if(a&&Date.now()-a.timestamp<this.CACHE_DURATION)return a.data;const o=await this.getContratadas({ativo:!0});return this.cache.set(t,{data:o,timestamp:Date.now()}),o}clearCache(){this.cache.clear()}}const h=new g;export{h as e};
