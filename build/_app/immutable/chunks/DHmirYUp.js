var v=Object.defineProperty;var A=(u,o,a)=>o in u?v(u,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):u[o]=a;var p=(u,o,a)=>A(u,typeof o!="symbol"?o+"":o,a);import{c as b,a as l}from"./D8PmxC0_.js";class _{constructor(){p(this,"baseEndpoint","/notas-movimentacao")}async listarNotas(o={}){var a,e,t,r,s,i;console.log("üìã NotasMovimentacaoAdapter: Listando notas via endpoint principal",o);try{const c=b(this.baseEndpoint,{page:(a=o.page)==null?void 0:a.toString(),limit:(e=o.limit)==null?void 0:e.toString(),dataInicio:o.dataInicio,dataFim:o.dataFim,status:o.status,tipo:o.tipo,numero:o.numero,usuarioId:o.responsavel_id,almoxarifadoId:o.almoxarifado_id}),d=await l.get(c,{timeout:3e4,retries:2});if(console.log("‚úÖ Notas carregadas:",d),d.success&&d.data)return{data:d.data.map(n=>{var m,f,h,E;return{id:n.id,numero:n.numero,tipo:n.tipo,status:n._status,createdAt:n.createdAt,observacoes:n.observacoes,usuarioId:n.usuarioId,almoxarifadoOrigemId:n.almoxarifadoOrigemId,almoxarifadoDestinoId:n.almoxarifadoDestinoId,responsavel_id:n.usuarioId,almoxarifado_id:n.almoxarifadoOrigemId||n.almoxarifadoDestinoId,almoxarifado_destino_id:n.almoxarifadoDestinoId,tipo_nota:n.tipo,_status:n._status,numero_documento:n.numero,data_documento:n.createdAt,created_at:n.createdAt,responsavel_nome:((m=n.usuario)==null?void 0:m.nome)||"N/A",almoxarifado_nome:((f=n.almoxarifadoOrigem)==null?void 0:f.nome)||((h=n.almoxarifadoDestino)==null?void 0:h.nome)||"N/A",almoxarifado_destino_nome:(E=n.almoxarifadoDestino)==null?void 0:E.nome,total_itens:n.totalItens||0,valor_total:n.valorTotal||0,itens:n._itens||[],_itens:n._itens||[],responsavel:n.usuario,almoxarifado:n.almoxarifadoOrigem||n.almoxarifadoDestino,almoxarifado_destino:n.almoxarifadoDestino}}),total:((t=d.pagination)==null?void 0:t.total)||0,page:((r=d.pagination)==null?void 0:r.page)||1,pageSize:((s=d.pagination)==null?void 0:s.limit)||10,totalPages:((i=d.pagination)==null?void 0:i.totalPages)||1};throw new Error("Resposta inv√°lida do servidor")}catch(c){throw console.error("‚ùå Erro ao listar notas:",c),new Error("N√£o foi poss√≠vel carregar as notas de movimenta√ß√£o")}}async obterNota(o){console.log("üîç NotasMovimentacaoAdapter: Buscando nota",o);try{const a=await l.get(`${this.baseEndpoint}/${o}`);console.log("‚úÖ Resposta obter nota:",a),console.log("üîç Estrutura da resposta:",JSON.stringify(a,null,2));let e;return a.success&&a.data||a.data?e=a.data:e=a,console.log("üìã Dados da nota processados:",JSON.stringify(e,null,2)),e}catch(a){throw console.error("‚ùå Erro ao buscar nota:",a),new Error("N√£o foi poss√≠vel encontrar a nota")}}async listarRascunhos(){var o;console.log("üìù NotasMovimentacaoAdapter: Listando rascunhos");try{const a=await l.get(`${this.baseEndpoint}/rascunhos`);return console.log("‚úÖ Resposta listar rascunhos:",a),a.success&&a.data?Array.isArray(a.data)?a.data:[]:Array.isArray(a.data)?a.data:(o=a.data)!=null&&o.items?a.data.items:[]}catch(a){throw console.error("‚ùå Erro ao listar rascunhos:",a),new Error("N√£o foi poss√≠vel carregar os rascunhos")}}async criarNota(o){console.log("üìù NotasMovimentacaoAdapter: Criando nota",o);try{if(!o.responsavel_id){console.log("‚ö†Ô∏è responsavel_id n√£o fornecido, buscando usu√°rio padr√£o...");try{const t=await l.get("/usuarios?limit=1");console.log("üîç Resposta usuarios endpoint:",t),t.items&&t.items.length>0?(o.responsavel_id=t.items[0].id,console.log("‚úÖ Usando responsavel_id:",o.responsavel_id)):t.success&&t.data&&t.data.length>0?(o.responsavel_id=t.data[0].id,console.log("‚úÖ Usando responsavel_id:",o.responsavel_id)):(console.log("‚ö†Ô∏è Nenhum usu√°rio encontrado, usando administrador padr√£o..."),o.responsavel_id="cffc2197-acbe-4a64-bfd7-435370e9c226",console.log("‚úÖ Usando responsavel_id do administrador:",o.responsavel_id))}catch(t){console.error("‚ùå Erro ao buscar usu√°rio:",t),o.responsavel_id="cffc2197-acbe-4a64-bfd7-435370e9c226",console.log("‚úÖ Usando responsavel_id do administrador (fallback):",o.responsavel_id)}}const a={tipo:o.tipo_nota};o.observacoes&&o.observacoes.trim()!==""&&(a.observacoes=o.observacoes.trim()),o.almoxarifado_origem_id&&(a.almoxarifadoOrigemId=o.almoxarifado_origem_id),o.almoxarifado_destino_id&&(a.almoxarifadoDestinoId=o.almoxarifado_destino_id),console.log("üì§ Dados para backend:",a);const e=await l.post(this.baseEndpoint,a);return console.log("‚úÖ Nota criada:",e),e.success&&e.data?{success:e.success,data:e.data}:e.data?{success:!0,data:e.data}:{success:!0,data:e}}catch(a){throw console.error("‚ùå Erro ao criar nota:",a),new Error("N√£o foi poss√≠vel criar a nota de movimenta√ß√£o")}}async atualizarNota(o,a){console.log("üìù NotasMovimentacaoAdapter: Atualizando nota",o,a);try{const e=await l.put(`${this.baseEndpoint}/${o}`,a);return console.log("‚úÖ Resposta atualizar nota:",e),e.success&&e.data||e.data?e.data:e}catch(e){throw console.error("‚ùå Erro ao atualizar nota:",e),new Error("N√£o foi poss√≠vel atualizar a nota")}}async excluirNota(o){console.log("üóëÔ∏è NotasMovimentacaoAdapter: Excluindo nota",o);try{await l.delete(`${this.baseEndpoint}/${o}`),console.log("‚úÖ Nota exclu√≠da:",o)}catch(a){throw console.error("‚ùå Erro ao excluir nota:",a),new Error("N√£o foi poss√≠vel excluir a nota")}}async adicionarItem(o,a){console.log("‚ûï NotasMovimentacaoAdapter: Adicionando item",o,a);try{if(!a.tipo_epi_id)throw new Error("ID do tipo EPI √© obrigat√≥rio");const e=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i,t=/^[A-Z0-9]{6}$/;if(!e.test(a.tipo_epi_id)&&!t.test(a.tipo_epi_id))throw console.error("‚ùå ID inv√°lido detectado:",a.tipo_epi_id),new Error(`ID do tipo EPI inv√°lido: ${a.tipo_epi_id}. Deve ser um UUID v√°lido ou ID customizado (ex: E4U302)`);const r={tipoEpiId:a.tipo_epi_id,quantidade:Number(a.quantidade)};a.observacoes&&a.observacoes.trim()!==""&&(r.observacoes=a.observacoes),console.log("üì§ Dados do item para backend:",r);const s=await l.post(`${this.baseEndpoint}/${o}/itens`,r);return console.log("‚úÖ Item adicionado:",s),s.success&&s.data||s.data?s.data:s}catch(e){throw console.error("‚ùå Erro ao adicionar item:",e),new Error("N√£o foi poss√≠vel adicionar o item √† nota")}}async atualizarQuantidade(o,a,e){console.log("üìù NotasMovimentacaoAdapter: Atualizando quantidade",o,a,e);try{await l.put(`${this.baseEndpoint}/${o}/itens/${a}`,{quantidade:Number(e)}),console.log("‚úÖ Quantidade atualizada")}catch(t){throw console.error("‚ùå Erro ao atualizar quantidade:",t),new Error("N√£o foi poss√≠vel atualizar a quantidade")}}async removerItem(o,a){console.log("üóëÔ∏è NotasMovimentacaoAdapter: Removendo item",o,a);try{await l.delete(`${this.baseEndpoint}/${o}/itens/${a}`),console.log("‚úÖ Item removido")}catch(e){throw console.error("‚ùå Erro ao remover item:",e),new Error("N√£o foi poss√≠vel remover o item")}}async concluirNota(o){console.log("‚ö° NotasMovimentacaoAdapter: Concluindo nota",o);try{const a=await l.post(`${this.baseEndpoint}/${o}/concluir`,{validarEstoque:!0});return console.log("‚úÖ Nota conclu√≠da:",a),a.success?{success:a.success,data:a.data}:a}catch(a){throw console.error("‚ùå Erro ao concluir nota:",a),new Error("N√£o foi poss√≠vel concluir a nota")}}async cancelarNota(o,a){console.log("üö´ NotasMovimentacaoAdapter: Cancelando nota",o);try{await l.post(`${this.baseEndpoint}/${o}/cancelar`,{motivo:a||"Cancelamento solicitado pelo usu√°rio",gerarEstorno:!0}),console.log("‚úÖ Nota cancelada:",o)}catch(e){throw console.error("‚ùå Erro ao cancelar nota:",e),new Error("N√£o foi poss√≠vel cancelar a nota")}}async validarCancelamento(o){console.log("üîç NotasMovimentacaoAdapter: Validando cancelamento",o);try{const a=await l.get(`${this.baseEndpoint}/${o}/validar-cancelamento`);return console.log("‚úÖ Valida√ß√£o de cancelamento:",a),a.success&&a.data||a.data?a.data:a}catch(a){return console.error("‚ùå Erro ao validar cancelamento:",a),{pode_cancelar:!1,motivo:"Erro na valida√ß√£o"}}}async obterNotaCompleta(o){return console.log("üîç NotasMovimentacaoAdapter: Buscando nota completa",o),this.obterNota(o)}async validarNotaAntesConcluir(o){var a,e,t;console.log("üîç NotasMovimentacaoAdapter: Valida√ß√£o local da nota",o);try{const r=await this.obterNota(o),s=[],i=[];(!r.itens||r.itens.length===0)&&s.push("Nota deve ter pelo menos um item"),(r.status==="CONCLUIDA"||r._status==="CONCLUIDA")&&s.push("Nota j√° foi conclu√≠da anteriormente"),(r.status==="CANCELADA"||r._status==="CANCELADA")&&s.push("Nota cancelada n√£o pode ser conclu√≠da");const c=s.length===0;return c&&i.push("Valida√ß√£o local aprovada"),console.log("‚úÖ Valida√ß√£o local conclu√≠da:",{podeConfirmar:c,erros:s.length,itens:(a=r.itens)==null?void 0:a.length}),{pode_concluir:c,erros:s,avisos:i,total_itens_processados:((e=r.itens)==null?void 0:e.length)||0,movimentacoes_previstas:((t=r.itens)==null?void 0:t.length)||0}}catch(r){return console.error("‚ùå Erro na valida√ß√£o local:",r),{pode_concluir:!1,erros:["N√£o foi poss√≠vel carregar dados da nota para valida√ß√£o"],avisos:["Erro na valida√ß√£o local"]}}}async obterOpcoesFilters(){console.log("üîß NotasMovimentacaoAdapter: Carregando op√ß√µes de filtros");try{const[o,a]=await Promise.all([l.get("/usuarios?limit=100"),l.get("/estoque/almoxarifados")]),e=(o==null?void 0:o.data)||(o==null?void 0:o.items)||[],t=(a==null?void 0:a.data)||[],r={responsaveis:e.map(s=>({value:s.id,label:s.nome||s.name||`Usu√°rio ${s.id.slice(0,8)}`})),almoxarifados:t.map(s=>({value:s.id,label:s.nome||s.name||`Almoxarifado ${s.id.slice(0,8)}`})),tipos:[{value:"ENTRADA",label:"Entrada"},{value:"TRANSFERENCIA",label:"Transfer√™ncia"},{value:"DESCARTE",label:"Descarte"},{value:"AJUSTE",label:"Ajuste"}],status:[{value:"RASCUNHO",label:"Rascunho"},{value:"CONCLUIDA",label:"Conclu√≠da"},{value:"CANCELADA",label:"Cancelada"}]};return console.log("‚úÖ Op√ß√µes de filtros carregadas:",{responsaveis:r.responsaveis.length,almoxarifados:r.almoxarifados.length}),r}catch(o){return console.error("‚ùå Erro ao carregar op√ß√µes de filtros:",o),{responsaveis:[],almoxarifados:[],tipos:[{value:"ENTRADA",label:"Entrada"},{value:"TRANSFERENCIA",label:"Transfer√™ncia"},{value:"DESCARTE",label:"Descarte"},{value:"AJUSTE",label:"Ajuste"}],status:[{value:"RASCUNHO",label:"Rascunho"},{value:"CONCLUIDA",label:"Conclu√≠da"},{value:"CANCELADA",label:"Cancelada"}]}}}}const O=new _;class q{constructor(){p(this,"baseEndpoint","/tipos-epi");p(this,"selectOptionsCache",null)}async listarTiposEpi(o){var a;console.log("üõ°Ô∏è TiposEpiAdapter: Listando tipos de EPI",o);try{const e=new URLSearchParams;o!=null&&o.page&&e.append("page",o.page.toString()),o!=null&&o.limit&&e.append("limit",o.limit.toString()),o!=null&&o.search&&e.append("search",o.search),o!=null&&o.categoria&&e.append("categoria",o.categoria);const t=`${this.baseEndpoint}?${e.toString()}`,r=await l.get(t);return console.log("‚úÖ Tipos de EPI listados:",r.data.pagination),{data:r.data.items,total:r.data.pagination.total,page:r.data.pagination.page,pageSize:r.data.pagination.limit,totalPages:r.data.pagination.totalPages}}catch(e){if(console.error("‚ùå Erro ao listar tipos de EPI:",e),e.name==="AbortError"||(a=e.message)!=null&&a.includes("timeout")){console.warn("‚ö†Ô∏è Backend indispon√≠vel, usando dados de fallback para tipos EPI");const t=this.getFallbackTiposEPI();return{data:t,total:t.length,page:1,pageSize:t.length,totalPages:1}}throw new Error("N√£o foi poss√≠vel carregar os tipos de EPI")}}async obterTipoEpi(o){console.log("üîç TiposEpiAdapter: Buscando tipo de EPI",o);try{const a=await l.get(`${this.baseEndpoint}/${o}`);return console.log("‚úÖ Tipo de EPI encontrado:",a.data.nome_equipamento),a.data}catch(a){throw console.error("‚ùå Erro ao buscar tipo de EPI:",a),new Error("N√£o foi poss√≠vel encontrar o tipo de EPI")}}async obterOpcoesSelect(o){console.log("üîß TiposEpiAdapter: Carregando op√ß√µes para select",o);try{const a={page:1,limit:(o==null?void 0:o.limite)||100};o!=null&&o.categoria&&(a.categoria=o.categoria);const e=await this.listarTiposEpi(a),t=i=>{const c=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i,d=/^[A-Z0-9]{6}$/;return c.test(i)||d.test(i)},r=e.data.filter(i=>{const c=t(i.id);return c||console.warn(`‚ö†Ô∏è Tipo EPI com ID inv√°lido ignorado: ${i.id} - ${i.nomeEquipamento}`),c});console.log(`üîç Tipos EPI v√°lidos: ${r.length} de ${e.data.length}`);const s=r.map(i=>{console.log("üîç Mapeando tipo EPI completo:",JSON.stringify(i,null,2)),console.log("üîç Campos dispon√≠veis:",Object.keys(i)),console.log("üîç nome_equipamento:",i.nome_equipamento),console.log("üîç nomeEquipamento:",i.nomeEquipamento),console.log("üîç nome:",i.nome),console.log("üîç name:",i.name);const c=i.nomeEquipamento||i.nome_equipamento||i.nome||i.name||"Nome n√£o identificado",d=i.numeroCa||i.numero_ca||i.numeroCA||i.ca||"N/A",g=i.categoria||i.category||"Sem categoria",n={value:i.id,label:`${c} (CA: ${d})`,categoria:g,numeroCA:d,custoUnitario:i.custo_unitario||i.custoUnitario||i.preco||0,status:i.status};return console.log("üéØ Op√ß√£o final criada:",n),n});return s.sort((i,c)=>i.label.localeCompare(c.label)),console.log("‚úÖ Op√ß√µes de select criadas:",s.length),s}catch(a){return console.error("‚ùå Erro ao criar op√ß√µes de select:",a),[]}}async obterOpcoesAgrupadasPorCategoria(){console.log("üìÇ TiposEpiAdapter: Agrupando op√ß√µes por categoria");try{const o=await this.obterOpcoesSelect({apenasAtivos:!0}),a={};return o.forEach(e=>{a[e.categoria]||(a[e.categoria]=[]),a[e.categoria].push(e)}),Object.keys(a).forEach(e=>{a[e].sort((t,r)=>t.label.localeCompare(r.label))}),console.log("‚úÖ Op√ß√µes agrupadas por categoria:",Object.keys(a)),a}catch(o){return console.error("‚ùå Erro ao agrupar op√ß√µes por categoria:",o),{}}}async obterOpcoesSelectComCache(o){const e=Date.now(),t=JSON.stringify(o||{});if(this.selectOptionsCache&&this.selectOptionsCache.key===t&&e-this.selectOptionsCache.timestamp<3e5)return console.log("üíæ TiposEpiAdapter: Usando cache para op√ß√µes select"),this.selectOptionsCache.data;const r=await this.obterOpcoesSelect(o);return this.selectOptionsCache={data:r,timestamp:e,key:t},r}async buscarTiposEpi(o){if(console.log("üîç TiposEpiAdapter: Buscando tipos de EPI",o),!o||o.length<2)return[];try{const e=(await this.listarTiposEpi({search:o,limit:20})).data.map(t=>{const r=t.nomeEquipamento||t.nome_equipamento||t.nome||t.name||"Nome n√£o identificado",s=t.numeroCa||t.numero_ca||t.numeroCA||t.ca||"N/A",i=t.categoria||t.category||"Sem categoria";return{value:t.id,label:`${r} (CA: ${s})`,categoria:i,numeroCA:s,custoUnitario:t.custo_unitario||t.custoUnitario||t.preco||0}});return console.log("‚úÖ Busca realizada, encontrados:",e.length),e}catch(a){return console.error("‚ùå Erro na busca de tipos de EPI:",a),[]}}async obterCategorias(){console.log("üìã TiposEpiAdapter: Carregando categorias");try{const o=await this.listarTiposEpi({limit:500}),a=[...new Set(o.data.map(e=>e.categoria))].filter(e=>e&&e.trim()!=="").sort();return console.log("‚úÖ Categorias encontradas:",a),a}catch(o){return console.error("‚ùå Erro ao carregar categorias:",o),[]}}async validarTipoEpiAtivo(o){try{return(await this.obterTipoEpi(o)).status==="ATIVO"}catch{return!1}}limparCache(){this.selectOptionsCache=null,console.log("üóëÔ∏è TiposEpiAdapter: Cache limpo")}clearCache(){this.limparCache()}async obterTiposPopulares(o=10){console.log("üåü TiposEpiAdapter: Carregando tipos populares");try{const e=(await this.listarTiposEpi({limit:o})).data.map(t=>{const r=t.nomeEquipamento||t.nome_equipamento||t.nome||t.name||"Nome n√£o identificado",s=t.numeroCa||t.numero_ca||t.numeroCA||t.ca||"N/A",i=t.categoria||t.category||"Sem categoria";return{value:t.id,label:`${r} (CA: ${s})`,categoria:i,numeroCA:s,custoUnitario:t.custo_unitario||t.custoUnitario||t.preco||0}});return console.log("‚úÖ Tipos populares carregados:",e.length),e}catch(a){return console.error("‚ùå Erro ao carregar tipos populares:",a),[]}}getFallbackTiposEPI(){return[{id:"fallback-1",nome_equipamento:"Capacete de Seguran√ßa (Demo)",numero_ca:"12345",categoria:"PROTECAO_CRANIO",custo_unitario:35.5,status:"ATIVO",created_at:new Date().toISOString()},{id:"fallback-2",nome_equipamento:"√ìculos de Prote√ß√£o (Demo)",numero_ca:"67890",categoria:"PROTECAO_OLHOS",custo_unitario:28.9,status:"ATIVO",created_at:new Date().toISOString()},{id:"fallback-3",nome_equipamento:"Luva de Seguran√ßa (Demo)",numero_ca:"54321",categoria:"PROTECAO_MAOS",custo_unitario:15.75,status:"ATIVO",created_at:new Date().toISOString()}]}}const w=new q,D=Object.freeze(Object.defineProperty({__proto__:null,tiposEpiAdapter:w},Symbol.toStringTag,{value:"Module"}));class x{constructor(){p(this,"baseEndpoint","/estoque/itens");p(this,"itensDisponiveis",{})}async listarItensEstoque(o){console.log("üì¶ EstoqueItensAdapter: Listando itens de estoque",o);try{const a=new URLSearchParams;o!=null&&o.page&&a.append("page",o.page.toString()),o!=null&&o.limit&&a.append("limit",o.limit.toString()),o!=null&&o.search&&a.append("search",o.search),o!=null&&o.almoxarifado_id&&a.append("almoxarifado_id",o.almoxarifado_id),o!=null&&o.tipo_epi_id&&a.append("tipo_epi_id",o.tipo_epi_id),o!=null&&o.status&&o.status!=="todos"&&a.append("status",o.status),o!=null&&o.categoria&&a.append("categoria",o.categoria);const e=`${this.baseEndpoint}?${a.toString()}`,t=await l.get(e);return console.log("‚úÖ Itens de estoque listados:",t.data.pagination),{data:t.data.items,total:t.data.pagination.total,page:t.data.pagination.page,pageSize:t.data.pagination.limit,totalPages:t.data.pagination.totalPages}}catch(a){throw console.error("‚ùå Erro ao listar itens de estoque:",a),new Error("N√£o foi poss√≠vel carregar os itens de estoque")}}async obterItensDisponiveisParaSaida(o){console.log("üöö EstoqueItensAdapter: Buscando itens dispon√≠veis para sa√≠da",o);try{const e=(await this.listarItensEstoque({almoxarifado_id:o,status:"DISPONIVEL",limit:100})).data.filter(t=>t.quantidade>0).map(t=>({value:t.id,label:`${t.tipo_epi.nome_equipamento} - ${t.quantidade} dispon√≠vel`,quantidade:t.quantidade,equipamento:t.tipo_epi.nome_equipamento,categoria:t.tipo_epi.categoria,numeroCA:t.tipo_epi.numero_ca,almoxarifado:t.almoxarifado.nome,almoxarifadoId:t.almoxarifado.id,quantidadeMaxima:t.quantidade,status:t.status,dataValidade:t.data_validade,lote:t.lote}));return e.sort((t,r)=>t.equipamento.localeCompare(r.equipamento)),console.log("‚úÖ Itens dispon√≠veis para sa√≠da:",e.length),e}catch(a){return console.error("‚ùå Erro ao buscar itens dispon√≠veis para sa√≠da:",a),[]}}async buscarItensEstoque(o,a){if(console.log("üîç EstoqueItensAdapter: Buscando itens de estoque",o,a),!o||o.length<2)return[];try{const e={search:o,limit:20,status:"DISPONIVEL",almoxarifado_id:a},r=(await this.listarItensEstoque(e)).data.map(s=>({value:s.id,label:`${s.tipo_epi.nome_equipamento} (${s.quantidade} dispon√≠vel)`,quantidade:s.quantidade,equipamento:s.tipo_epi.nome_equipamento,categoria:s.tipo_epi.categoria,numeroCA:s.tipo_epi.numero_ca,almoxarifado:s.almoxarifado.nome,almoxarifadoId:s.almoxarifado.id,quantidadeMaxima:s.quantidade,status:s.status,dataValidade:s.data_validade,lote:s.lote}));return console.log("‚úÖ Busca realizada, encontrados:",r.length),r}catch(e){return console.error("‚ùå Erro na busca de itens de estoque:",e),[]}}async obterItemEstoque(o){console.log("üîç EstoqueItensAdapter: Buscando item de estoque",o);try{const a=await l.get(`${this.baseEndpoint}/${o}`);return console.log("‚úÖ Item de estoque encontrado:",a.data.tipo_epi.nome_equipamento),a.data}catch(a){throw console.error("‚ùå Erro ao buscar item de estoque:",a),new Error("N√£o foi poss√≠vel encontrar o item de estoque")}}async validarQuantidadeDisponivel(o,a){console.log("‚úÖ EstoqueItensAdapter: Validando quantidade dispon√≠vel",o,a);try{const e=await this.obterItemEstoque(o);return e.status!=="DISPONIVEL"?{valido:!1,quantidadeDisponivel:e.quantidade,motivo:`Item n√£o est√° dispon√≠vel (status: ${e.status})`}:a>e.quantidade?{valido:!1,quantidadeDisponivel:e.quantidade,motivo:`Quantidade desejada (${a}) √© maior que a dispon√≠vel (${e.quantidade})`}:a<=0?{valido:!1,quantidadeDisponivel:e.quantidade,motivo:"Quantidade deve ser maior que zero"}:{valido:!0,quantidadeDisponivel:e.quantidade}}catch(e){return console.error("‚ùå Erro ao validar quantidade dispon√≠vel:",e),{valido:!1,quantidadeDisponivel:0,motivo:"Erro ao validar item de estoque"}}}async obterItensAgrupadosPorTipo(o){console.log("üìä EstoqueItensAdapter: Agrupando itens por tipo de EPI",o);try{const a=await this.listarItensEstoque({almoxarifado_id:o,status:"DISPONIVEL",limit:500}),e={};return a.data.forEach(t=>{const r=t.tipo_epi.id;e[r]||(e[r]={tipo_epi:t.tipo_epi,itens:[],quantidade_total:0}),e[r].itens.push(t),e[r].quantidade_total+=t.quantidade}),console.log("‚úÖ Itens agrupados por tipo:",Object.keys(e).length),e}catch(a){return console.error("‚ùå Erro ao agrupar itens por tipo:",a),{}}}async obterItensDisponiveisComCache(o){const e=Date.now(),t=this.itensDisponiveis[o];if(t&&e-t.timestamp<12e4)return console.log("üíæ EstoqueItensAdapter: Usando cache para itens dispon√≠veis"),t.data;const r=await this.obterItensDisponiveisParaSaida(o);return this.itensDisponiveis[o]={data:r,timestamp:e},r}limparCache(o){o?(delete this.itensDisponiveis[o],console.log("üóëÔ∏è EstoqueItensAdapter: Cache limpo para almoxarifado",o)):(this.itensDisponiveis={},console.log("üóëÔ∏è EstoqueItensAdapter: Cache completo limpo"))}clearCache(){this.limparCache()}async obterItensBaixoEstoque(o){console.log("‚ö†Ô∏è EstoqueItensAdapter: Buscando itens com baixo estoque");try{const e=(await this.listarItensEstoque({almoxarifado_id:o,status:"BAIXO",limit:100})).data.map(t=>({value:t.id,label:`${t.tipo_epi.nome_equipamento} - ${t.quantidade} restante`,quantidade:t.quantidade,equipamento:t.tipo_epi.nome_equipamento,categoria:t.tipo_epi.categoria,numeroCA:t.tipo_epi.numero_ca,almoxarifado:t.almoxarifado.nome,almoxarifadoId:t.almoxarifado.id,quantidadeMaxima:t.quantidade,status:t.status,dataValidade:t.data_validade,lote:t.lote}));return console.log("‚úÖ Itens com baixo estoque:",e.length),e}catch(a){return console.error("‚ùå Erro ao buscar itens com baixo estoque:",a),[]}}async verificarDisponibilidadeRealTime(o){console.log("üîÑ EstoqueItensAdapter: Verificando disponibilidade em tempo real");const a=await Promise.all(o.map(async e=>{try{const t=await this.validarQuantidadeDisponivel(e.itemId,e.quantidade);return{itemId:e.itemId,disponivel:t.valido,quantidadeAtual:t.quantidadeDisponivel,motivo:t.motivo}}catch{return{itemId:e.itemId,disponivel:!1,quantidadeAtual:0,motivo:"Erro ao verificar item"}}}));return console.log("‚úÖ Verifica√ß√£o conclu√≠da:",a.length),a}}const I=new x,S=Object.freeze(Object.defineProperty({__proto__:null,estoqueItensAdapter:I},Symbol.toStringTag,{value:"Module"}));class y{constructor(){p(this,"baseEndpoint","/estoque/almoxarifados");p(this,"selectOptionsCache",null)}async listarAlmoxarifados(){var o;console.log("üè™ AlmoxarifadosAdapter: Listando almoxarifados via estoque");try{try{console.log("üîç Tentando endpoint direto:",this.baseEndpoint);const a=await l.get(this.baseEndpoint,{timeout:15e3,retries:1});console.log("üì¶ Resposta recebida:",a);let e=[];return a.success&&a.data?e=Array.isArray(a.data)?a.data:[]:Array.isArray(a)?e=a:(console.warn("‚ö†Ô∏è Estrutura de resposta inesperada:",a),e=[]),console.log("üîç Almoxarifados recebidos do backend:",e.map(t=>({id:t.id,nome:t.nome}))),console.log("‚úÖ Almoxarifados listados via endpoint direto:",e.length),e.length===0?(console.warn("‚ö†Ô∏è Nenhum almoxarifado retornado, usando fallback"),this.getFallbackAlmoxarifados()):e}catch{console.log("‚ö†Ô∏è Endpoint direto n√£o dispon√≠vel, extraindo de estoque...");const e=await l.get("/estoque/itens?limit=100"),t=new Map;e.data.items.forEach(s=>{const i=s.almoxarifado;i&&!t.has(i.id)&&t.set(i.id,{id:i.id,nome:i.nome,unidadeNegocioId:i.unidadeNegocioId,isPrincipal:i.nome.toLowerCase().includes("central"),createdAt:new Date().toISOString(),unidadeNegocio:{id:i.unidadeNegocio.id,nome:i.unidadeNegocio.nome,codigo:i.unidadeNegocio.codigo}})});const r=Array.from(t.values());return console.log("‚úÖ Almoxarifados extra√≠dos do estoque:",r.length),r}}catch(a){if(console.error("‚ùå Erro ao listar almoxarifados:",a),a.name==="AbortError"||(o=a.message)!=null&&o.includes("timeout"))return console.warn("‚ö†Ô∏è Backend indispon√≠vel, usando dados de fallback"),this.getFallbackAlmoxarifados();throw new Error("N√£o foi poss√≠vel carregar os almoxarifados")}}async listarAlmoxarifadosPaginados(o){console.log("üè™ AlmoxarifadosAdapter: Listando almoxarifados com pagina√ß√£o",o);try{const a=new URLSearchParams;o!=null&&o.page&&a.append("page",o.page.toString()),o!=null&&o.limit&&a.append("limit",o.limit.toString()),o!=null&&o.search&&a.append("search",o.search);const e=`${this.baseEndpoint}?${a.toString()}`,t=await l.get(e);return console.log("‚úÖ Almoxarifados paginados listados:",t.data.pagination),{data:t.data.items,total:t.data.pagination.total,page:t.data.pagination.page,pageSize:t.data.pagination.limit,totalPages:t.data.pagination.totalPages}}catch(a){throw console.error("‚ùå Erro ao listar almoxarifados paginados:",a),new Error("N√£o foi poss√≠vel carregar os almoxarifados")}}async obterAlmoxarifado(o){console.log("üîç AlmoxarifadosAdapter: Buscando almoxarifado",o);try{const a=await l.get(`${this.baseEndpoint}/${o}`);return console.log("‚úÖ Almoxarifado encontrado:",a.data.nome),a.data}catch(a){throw console.error("‚ùå Erro ao buscar almoxarifado:",a),new Error("N√£o foi poss√≠vel encontrar o almoxarifado")}}async obterOpcoesSelect(){console.log("üîß AlmoxarifadosAdapter: Carregando op√ß√µes para select");try{const a=(await this.listarAlmoxarifados()).map(e=>{var t;return{value:e.id,label:e.nome,isPrincipal:e.isPrincipal,unidadeNegocio:(t=e.unidadeNegocio)==null?void 0:t.nome}});return a.sort((e,t)=>e.isPrincipal&&!t.isPrincipal?-1:!e.isPrincipal&&t.isPrincipal?1:e.label.localeCompare(t.label)),console.log("‚úÖ Op√ß√µes de select criadas:",a.length),a}catch(o){return console.error("‚ùå Erro ao criar op√ß√µes de select:",o),[]}}async obterOpcoesSelectComCache(){const a=Date.now();if(this.selectOptionsCache&&a-this.selectOptionsCache.timestamp<3e5)return console.log("üíæ AlmoxarifadosAdapter: Usando cache para op√ß√µes select"),this.selectOptionsCache.data;const e=await this.obterOpcoesSelect();return this.selectOptionsCache={data:e,timestamp:a},e}limparCache(){this.selectOptionsCache=null,console.log("üóëÔ∏è AlmoxarifadosAdapter: Cache limpo")}clearCache(){this.limparCache()}async validarExistencia(o){try{return await this.obterAlmoxarifado(o),!0}catch{return!1}}async obterAlmoxarifadosPrincipais(){console.log("üèÜ AlmoxarifadosAdapter: Buscando almoxarifados principais");try{const a=(await this.listarAlmoxarifados()).filter(e=>e.isPrincipal);return console.log("‚úÖ Almoxarifados principais encontrados:",a.length),a}catch(o){throw console.error("‚ùå Erro ao buscar almoxarifados principais:",o),new Error("N√£o foi poss√≠vel carregar os almoxarifados principais")}}getFallbackAlmoxarifados(){return[{id:"567a1885-0763-4a13-b9f6-157daa39ddc3",nome:"Almoxarifado Central SP",unidadeNegocioId:"d42d0657-4671-4026-ae34-61b74806ad9d",isPrincipal:!0,createdAt:new Date().toISOString(),unidadeNegocio:{id:"d42d0657-4671-4026-ae34-61b74806ad9d",nome:"Matriz S√£o Paulo",codigo:"SP001"}},{id:"fallback-2",nome:"Almoxarifado Obra (Demo)",unidadeNegocioId:"unidade-2",isPrincipal:!1,createdAt:new Date().toISOString(),unidadeNegocio:{id:"unidade-2",nome:"Obra A",codigo:"OA01"}}]}}const P=new y;export{P as a,D as b,S as c,I as e,O as n,w as t};
