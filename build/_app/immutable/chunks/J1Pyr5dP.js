import{a as m,c as v}from"./Dwq3Do7L.js";class O{async obterKardex(o){try{console.log("üìä Buscando kardex:",o);const{almoxarifadoId:a,tipoEpiId:r,dataInicio:d,dataFim:s}=o,l=new URLSearchParams;d&&l.append("dataInicio",d),s&&l.append("dataFim",s);const g=l.toString(),u=`/estoque/kardex/${a}/${r}${g?`?${g}`:""}`;console.log("üì° Chamando endpoint:",u);const p=await m.get(u);if(p.success&&p.data){const i=p.data,n={movimentacoes:i.movimentacoes||[],saldoInicial:i.saldoInicial||0,saldoFinal:i.saldoFinal||0,totalEntradas:i.totalEntradas||0,totalSaidas:i.totalSaidas||0};return n.movimentacoes.sort((e,I)=>new Date(I.data).getTime()-new Date(e.data).getTime()),console.log("‚úÖ Kardex carregado:",{movimentacoes:n.movimentacoes.length,saldoInicial:n.saldoInicial,saldoFinal:n.saldoFinal,totalEntradas:n.totalEntradas,totalSaidas:n.totalSaidas}),n}throw new Error("Dados de kardex n√£o encontrados")}catch(a){throw console.error("‚ùå Erro ao buscar kardex:",a),a}}async obterKardexPorPeriodo(o,a,r){const d=new Date().toISOString().split("T")[0],s=new Date(Date.now()-r*24*60*60*1e3).toISOString().split("T")[0];return this.obterKardex({almoxarifadoId:o,tipoEpiId:a,dataInicio:s,dataFim:d})}getMockKardexData(){return{movimentacoes:[{data:new Date(Date.now()-1*24*60*60*1e3).toISOString(),documento:"E4U302",tipoMovimentacao:"SAIDA_ENTREGA",entrada:0,saida:2,saldo:78,observacoes:"Entrega para Jo√£o Silva"},{data:new Date(Date.now()-2*24*60*60*1e3).toISOString(),documento:"ENT-2025-000123",tipoMovimentacao:"ENTRADA_NOTA",entrada:50,saida:0,saldo:80,observacoes:"Compra de EPIs"},{data:new Date(Date.now()-5*24*60*60*1e3).toISOString(),documento:"DEV-2025-000045",tipoMovimentacao:"ENTRADA_DEVOLUCAO",entrada:3,saida:0,saldo:30,observacoes:"Devolu√ß√£o de Maria Santos"},{data:new Date(Date.now()-7*24*60*60*1e3).toISOString(),documento:"TRF-2025-000012",tipoMovimentacao:"SAIDA_TRANSFERENCIA",entrada:0,saida:5,saldo:27,observacoes:"Transfer√™ncia para Almoxarifado Central"},{data:new Date(Date.now()-10*24*60*60*1e3).toISOString(),documento:"AJU-2025-000003",tipoMovimentacao:"AJUSTE_POSITIVO",entrada:2,saida:0,saldo:32,observacoes:"Ajuste de invent√°rio"}],saldoInicial:30,saldoFinal:78,totalEntradas:55,totalSaidas:7}}}const h=new O;class P{async getInventoryItems(o={}){var a,r,d,s,l,g,u,p;console.log("üö® ADAPTER CHAMADO: Buscando itens do invent√°rio:",o),console.log("üö® API_BASE_URL atual:","production");try{const i={page:o.page||1,pageSize:o.pageSize||20,...o.search&&{search:o.search},...o.status&&{status:o.status},...o.categoria&&{categoria:o.categoria},...o.includeExpanded&&{includeExpanded:!0}},n=v("/estoque/itens",i);console.log("üîó URL constru√≠da:",n);const e=await m.get(n);console.log("üîç Resposta bruta do backend estoque:",e),console.log("üîç Estrutura dos dados:",{hasData:!!e.data,hasItems:!!((a=e.data)!=null&&a.items),itemsLength:(d=(r=e.data)==null?void 0:r.items)==null?void 0:d.length,firstItem:(l=(s=e.data)==null?void 0:s.items)==null?void 0:l[0],pagination:(g=e.data)==null?void 0:g.pagination});const I=((u=e.data)==null?void 0:u.items)||e.items||[];console.log("üîç Items encontrados no backend:",I.length);const S=I.map(t=>{var A,D;return{...t,almoxarifadoId:t.almoxarifadoId||((A=t.almoxarifado)==null?void 0:A.id),tipoEPIId:t.tipoEPIId||t.tipoEpiId||((D=t.tipoEpi)==null?void 0:D.id),tipoEPI:t.tipoEpi?{...t.tipoEpi,id:t.tipoEpi.id,numeroCA:t.tipoEpi.numeroCa||t.tipoEpi.numeroCA,nomeEquipamento:t.tipoEpi.nomeEquipamento||t.tipoEpi.nome,categoria:t.tipoEpi.categoriaEpi||t.tipoEpi.categoria}:void 0,status:t.status||"DISPONIVEL",almoxarifado:t.almoxarifado?{...t.almoxarifado,id:t.almoxarifado.id}:void 0}}),c=((p=e.data)==null?void 0:p.pagination)||e.pagination||{},E={data:S,total:c.total||S.length,page:c.page||o.page||1,pageSize:c.limit||c.pageSize||o.pageSize||20,totalPages:c.totalPages||Math.ceil((c.total||S.length)/(c.limit||c.pageSize||o.pageSize||20))};return console.log("‚úÖ Itens do invent√°rio mapeados:",E),E}catch(i){console.error("‚ùå Erro ao buscar itens do invent√°rio:",i),console.error("‚ùå Erro detalhado:",{message:i.message,status:i.status,response:i.response,url}),console.log("üîÑ Usando dados mockados para desenvolvimento - Status:",o.status);const n={DISPONIVEL:[{id:"disp-1",tipoEPIId:"tipo-1",almoxarifadoId:"alm-1",quantidade:25,status:"DISPONIVEL",dataUltimaMovimentacao:new Date().toISOString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),tipoEPI:{id:"tipo-1",nomeEquipamento:"Capacete Dispon√≠vel",numeroCA:"11111",categoria:"Prote√ß√£o da Cabe√ßa",ativo:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},almoxarifado:{id:"alm-1",nome:"Almoxarifado Principal",codigo:"ALMP001",ativo:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}],QUARENTENA:[{id:"quar-1",tipoEPIId:"tipo-2",almoxarifadoId:"alm-1",quantidade:8,status:"QUARENTENA",dataUltimaMovimentacao:new Date().toISOString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),tipoEPI:{id:"tipo-2",nomeEquipamento:"Luvas em Quarentena",numeroCA:"22222",categoria:"Prote√ß√£o das M√£os",ativo:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},almoxarifado:{id:"alm-1",nome:"Almoxarifado Principal",codigo:"ALMP001",ativo:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}],AGUARDANDO_INSPECAO:[{id:"insp-1",tipoEPIId:"tipo-3",almoxarifadoId:"alm-1",quantidade:5,status:"AGUARDANDO_INSPECAO",dataUltimaMovimentacao:new Date().toISOString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),tipoEPI:{id:"tipo-3",nomeEquipamento:"√ìculos Aguardando Inspe√ß√£o",numeroCA:"33333",categoria:"Prote√ß√£o dos Olhos",ativo:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},almoxarifado:{id:"alm-1",nome:"Almoxarifado Principal",codigo:"ALMP001",ativo:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}]},e=n[o.status]||n.DISPONIVEL;return{data:e,total:e.length,page:1,pageSize:20,totalPages:1}}}async getItemMovementHistory(o,a={}){console.log("üìä Buscando hist√≥rico do item:",o,a);try{const r={limit:a.limit||100,...a.dataInicio&&{dataInicio:a.dataInicio},...a.dataFim&&{dataFim:a.dataFim}},d=v(`/estoque/itens/${o}/movimentacoes`,r),s=await m.get(d);return console.log("‚úÖ Hist√≥rico do item obtido com sucesso:",s.length),s}catch(r){throw console.error("‚ùå Erro ao buscar hist√≥rico do item:",r),r}}async registerMovement(o){console.log("üìù Registrando movimenta√ß√£o:",o);try{const a=await m.post("/estoque/movimentacoes",o);return console.log("‚úÖ Movimenta√ß√£o registrada com sucesso:",a),a}catch(a){throw console.error("‚ùå Erro ao registrar movimenta√ß√£o:",a),a}}async registerEntry(o){const a={tipoEPIId:o.tipoEpiId,almoxarifadoId:o.almoxarifadoId,quantidade:o.quantidade,observacoes:o.observacoes,tipoMovimentacao:"ENTRADA_COMPRA",motivo:"Entrada por compra"};return this.registerMovement(a)}async registerExit(o){const a={tipoEPIId:o.tipoEpiId,almoxarifadoId:o.almoxarifadoId,quantidade:o.quantidade,observacoes:o.observacoes,tipoMovimentacao:"SAIDA_ENTREGA",motivo:"Sa√≠da por entrega"};return this.registerMovement(a)}async registerAdjustment(o){const a={tipoEPIId:o.tipoEpiId,almoxarifadoId:o.almoxarifadoId,quantidade:o.quantidade,observacoes:o.motivo,responsavelId:o.responsavelId,tipoMovimentacao:"AJUSTE_INVENTARIO"};return this.registerMovement(a)}async registerTransfer(o){try{const a=await m.post("/estoque/transferencias",o);return console.log("‚úÖ Transfer√™ncia registrada com sucesso:",a),a}catch(a){throw console.error("‚ùå Erro ao registrar transfer√™ncia:",a),a}}async criarEstorno(o){try{const a=await m.post("/estoque/estornos",o);return console.log("‚úÖ Estorno registrado com sucesso:",a),a}catch(a){throw console.error("‚ùå Erro ao criar estorno:",a),a}}clearCache(){console.log("üóëÔ∏è Cache do InventoryCommandAdapter limpo")}}const f=new P;export{f as i,h as k};
